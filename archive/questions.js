// ============================================================================
// === QUESTIONS DATA: SCENARIOS ==============================================
// ============================================================================
// This file defines all of the scenario data used by the UE5 Scenario Tracker.
// Each key in the SCENARIOS object represents an interactive debugging "ticket"
// in a Jira-style format.
// ----------------------------------------------------------------------------
// STRUCTURE OVERVIEW:
//
// SCENARIO {
//   meta: { 
//     title: string, 
//     description: string, 
//     estimateHours: number // Target completion time for efficiency score
//   },
//   start: "step-id", // The key of the first step to display
//   steps: {
//     'step-id': {
//       isTask: true | false, // True if a core problem/False if a dead-end follow-up
//       skill: 'category',    // Used for tracking skill focus (e.g., 'rep', 'anim')
//       title: 'Step Title',
//       prompt: '<p>HTML prompt text...</p>',
//       choices: [
//         {
//           text: 'The choice text.',
//           type: 'correct' | 'partial' | 'misguided' | 'wrong', // Maps to time cost (0.5, 1.0, 1.5, 2.0 hrs)
//           feedback: '<p>HTML feedback text with points/time cost...</p>',
//           next: 'next-step-id' | 'conclusion' // ID of the next step or 'conclusion' to finish the ticket
//         },
//         // ... other choices
//       ]
//     }
//   }
// }
// ----------------------------------------------------------------------------

window.SCENARIOS = {
  // --------------------------------------------------------------------------
  // GOLEM SCENARIO: A deep dive into multiple systems (Compilation, Anim, VFX, Perf, Rep)
  // --------------------------------------------------------------------------
  golem: {
    meta: {
      title: "BP_GuardianGolem is Non-Functional: Full Debug Hunt",
      description:
        "Critical enemy asset fails to spawn, T-poses, leaks VFX memory, and breaks on the network.",
      estimateHours: 14.0 // Adjusted for increased debugging complexity and dead ends
    },
    start: "step-1",
    steps:
      {
        // === 1. COMPILATION & CLASS ABSTRACTION ISSUES ===
        'step-1': {
          isTask: true, 
          skill:'compile',
          title:'Abstract Class Error',
          prompt:"<p>You try to place <code>BP_GuardianGolem</code> in the level, but nothing happens. The <strong>Output Log</strong> shows: <code>Error: Could not create actor... The class is abstract and must be subclassed.</code></p><strong>What is the cause of this abstract class error in Blueprints?</strong>",
          choices:[
            {text:"Implement the required unimplemented function inherited from the parent C++ class.",type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> The Blueprint is abstract because it inherits an unimplemented event, often marked with an error in the My Blueprint panel.</p>",next:'step-2'},
            {text:'Delete the asset and re-create it, hoping the corruption clears.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> This is a destructive action that won\'t solve the root inheritance problem.</p>",next:'step-1W'},
            {text:'Check the Blueprint\'s variables for an unchecked <code>Expose on Spawn</code> property.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> <code>Expose on Spawn</code> is related to spawning but does not make a class abstract. This fix is misguided and wastes time.</p>",next:'step-1M'},
            {text:'Recompile the parent C++ code without making any changes.',type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> This is an indirect approach. You need to investigate the inherited functions.</p>",next:'step-3'}
          ]
        },
        
        'step-1W': {isTask: false, skill:'compile',title:'Asset Deletion Wastes Time',prompt:"<p>Deleting and recreating the asset failed to fix the error because the problem is inherited from the parent class. You must now find the function.</p><strong>How do you find the unimplemented function?</strong>",choices:[{text:'In the My Blueprint panel, right-click the parent function name and select "Implement function".',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> Re-focusing on the correct workflow. The editor guides you to implement required functions.</p>",next:'step-3'},{text:'Open the parent C++ class and remove the "BlueprintImplementableEvent" tag.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> Dangerous code change that breaks the game systems relying on this event.</p>",next:'step-3'}]},
        
        'step-1M': {isTask: false, skill:'compile',title:'Misguided Variable Check Failure',prompt:"<p>Checking the <code>Expose on Spawn</code> property did not resolve the abstract class error. This property only affects variables passed during the <code>Spawn Actor</code> node and is not the cause of an abstract class definition.</p><strong>You realize this was a dead end. What should you do next to address the abstract class error?</strong>",choices:[{text:'Go back and investigate the inherited functions in the My Blueprint panel.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> Returning to the correct path, you realize the error is caused by an unimplemented inherited function.</p>",next:'step-3'},{text:'Try recompiling the parent C++ code again (Partial answer from Step 1).',type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> You are still avoiding the direct investigation, wasting more time on indirect fixes.</p>",next:'step-3'}]},

        // === 2. ANIMATION & DATA FLOW ISSUES ===
        'step-2': {isTask: true, skill:'anim',title:'The Runtime T-Pose',prompt:"<p>The Golem now spawns, but is stuck in a T-Pose. The AnimBP preview is working, but the in-game character is frozen.</p><strong>Where is the most likely data disconnect preventing animation playback?</strong>",choices:[{text:"Trace the AnimBP's Event Graph logic to ensure data variables (like Speed) are being updated from the main Golem Blueprint (Cast failure).",type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> The <code>AnimBP</code> is a separate machine that relies on data from the character. If the <code>Cast</code> fails, the <code>State Machine</code> defaults to its entry pose (T-Pose).</p>",next:'step-3'},{text:'Change the Skeletal Mesh Component\'s "Animation Mode" to "Use Animation Asset".',type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> This would play a single animation, not result in a T-Pose, suggesting the <code>AnimBP</code> is assigned but not driven.</p>",next:'step-3'},{text:'Reimport the Skeletal Mesh and all associated animations.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> The preview works, confirming the asset is fine. The problem is runtime logic.</p>",next:'step-2W'},{text:'Check if the character\'s physics asset is blocking movement.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> You think this is a physics issue and check the Golem\'s Physics Asset.</p>",next:'step-2M'}]},
        
        // Dead-end: Mistaking T-pose for asset corruption
        'step-2W': {isTask: false, skill:'anim',title:'Asset Reimport Was Useless',prompt:"<p>You wasted maximum time re-importing the Golem mesh and animations. The issue persists. Since the animation preview works, the issue is clearly runtime logic, not asset corruption.</p><strong>Where must the core data flow failure lie?</strong>",choices:[{text:'Check the data casting between the AnimBP and the main Golem Blueprint.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> You correctly refocused on the AnimBP\'s dependency on the Golem\'s runtime data.</p>",next:'step-3'},{text:'Check the Golem\'s <code>Movement Mode</code>, maybe it\'s set to <code>None</code>.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> This is an unrelated fix. Movement mode doesn\'t affect the AnimBP ticking logic.</p>",next:'step-3'}]},

        // Dead-end: Mistaking T-pose for physics issues
        'step-2M': {isTask: false, skill:'anim',title:'Physics Asset Investigation (Dead End)',prompt:"<p>You spent extended time reviewing and simplifying the Golem's <code>Physics Asset</code>. While optimization is good, it had no effect on the T-pose because the character's animation system runs separately from the physics simulation.</p><strong>You realize the problem must be in the AnimBP's initialization. What is the next step?</strong>",choices:[{text:'Check the data casting between the AnimBP and the main Golem Blueprint.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> Correctly identifying the AnimBP's dependency on character data as the root cause.</p>",next:'step-3'},{text:'Check if the Golem\'s <code>Skeletal Mesh Component</code> is set to <code>Visible</code>.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> The Golem is visible, just T-posing. This is an obviously wrong check.</p>",next:'step-3'}]},
        
        'step-3': {isTask: true, skill:'anim',title:'Tracing the Data Flow Failure',prompt:"<p>You find the AnimBP's <code>Cast to BP_GuardianGolem</code> node fails immediately on <code>Event Blueprint Update Animation</code> due to a timing issue.</p><strong>What is the standard, robust pattern to fix this AnimBP casting failure?</strong>",choices:[{text:"Use <code>Event Blueprint Initialize Animation</code> to establish a solid reference to the Golem once, avoiding the per-frame cast and potential timing issues.",type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> Initializing the reference once at the correct time is far more efficient than casting every frame on Update Animation.</p>",next:'step-4'},{text:'Add an <code>IsValid</code> check after the Cast. Only update variables if the Cast succeeds.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> This prevents crashes but causes a jarring pop-in (visual technical debt) as the character T-poses until the Cast succeeds.</p>",next:'step-4'},{text:'Add a 0.2 second Delay before the Cast to ensure the character is fully possessed.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> This is a brittle, \'magic number\' fix prone to failing on different machine speeds or during hitches.</p>",next:'step-4'},{text:'Move the Cast logic to the Golem Blueprint and send the data back to the AnimBP via a variable binding.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> This inverts the data flow complexity and doesn\'t solve the core timing issue.</p>",next:'step-4'}]},
        'step-4': {isTask: true, skill:'anim',title:'The T-Pose Visual Tech Debt',prompt:"<p>You choose the <strong>Partial</strong> answer (the <code>IsValid</code> check). The Golem animates, but QA reports the Golem \"snaps\" from a T-pose when it first spawns. The lead asks you to move on, but you know this is bad practice.</p><strong>What do you call the best practice pattern you should have used?</strong>",choices:[{text:"The robust, event-driven reference initialization pattern (using <code>Initialize Animation</code>).",type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> Acknowledging the tech debt and remembering the best practice. This is the correct soft skill.</p>",next:'step-5'},{text:'The <code>Character Movement Component</code> has its <code>Default Land Movement Mode</code> set to None.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> Unrelated to the animation initialization issue.</p>",next:'step-5'},{text:'The AnimBP is overriding the wrong function, it should use <code>Post Update Animation</code>.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> <code>Update Animation</code> is the correct place to update variables.</p>",next:'step-5'},{text:'The delay node was still the better solution for reliability.',type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> Still believing in the fragile delay solution shows a lack of understanding of event-driven reliability.</p>",next:'step-5'}]},
        
        // === 3. VFX, SOUND, & ACTOR LIFECYCLE ISSUES ===
        'step-5': {isTask: true, skill:'vfx',title:'The Missing Anim Notify',prompt:"<p>The Golem animates, but a crucial ground-shatter VFX is missing during the Slam Attack. The VFX is triggered by an <code>Anim Notify</code> called <code>FX_SlamImpact</code>.</p><strong>What is your primary check when debugging a failing Anim Notify?</strong>",choices:[{text:"Open the Animation Sequence (A_Golem_Slam) and verify the <code>FX_SlamImpact</code> notify exists on the <code>Notify Track</code> and is correctly placed/spelled.",type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> The <code>Anim Notify</code> asset and its timeline placement are the source. Missing or misspelled notifies are the most common cause.</p>",next:'step-6'},{text:'Place a breakpoint on the corresponding event in the AnimBP\'s <code>Event Graph</code>.',type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> This is a good second step, but if the notify is missing from the timeline, the breakpoint will never be hit, wasting time tracing the wrong component.</p>",next:'step-6'},{text:'Check the <code>Niagara System</code> asset to ensure it is not compiled with errors.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> You have no evidence the <code>Niagara System</code> is the problem yet; the issue points to the trigger mechanism.</p>",next:'step-6'},{text:'Change the notify\'s timing in the Montage instead of the <code>Anim Sequence</code>.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> <code>Anim Notifies</code> are placed on the base sequence, not the montage layer.</p>",next:'step-6'}]},
        'step-6': {isTask: true, skill:'vfx',title:'The Emitter Spawns at Origin',prompt:"<p>You fix a typo in the <code>Anim Notify</code> name, and the VFX plays, but it always spawns at the world origin (0,0,0) instead of under the Golem's foot.</p><strong>How do you fix the VFX spawn location?</strong>",choices:[{text:'Use <code>Spawn Emitter Attached</code> and provide the Golem\'s mesh and a foot socket name as the attach point.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> Attaching ensures the effect tracks the skeletal mesh, using relative transforms for the most accurate and robust positioning.</p>",next:'step-7'},{text:'Use <code>Get Socket Location</code> on the mesh and feed that world location into <code>Spawn Emitter at Location</code>.',type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> This works, but is less robust. If the Golem moves rapidly, the location could be slightly off before the next tick updates the position.</p>",next:'step-7'},{text:"Manually add the Golem's world location to a hard-coded offset vector.",type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> Brittle fix that breaks if the Golem's location or rotation changes dramatically.</p>",next:'step-7'},{text:'The <code>Niagara System</code> needs its <code>Local Space</code> flag enabled.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> You are attempting to fix the world-space location with a local-space particle setting.</p>",next:'step-6W'}]},
        
        // Dead-end: Mismatching world vs local space settings for spawn
        'step-6W': {isTask: false, skill:'vfx',title:'Local Space Confusion (Dead End)',prompt:"<p>You tried enabling <code>Local Space</code> in the <code>Niagara System</code>, but it had no effect on the emitter's spawn location. <code>Local Space</code> only controls whether the particles move with the emitter's parent. The issue is where the emitter's *container* is spawned in the world.</p><strong>What is the correct way to handle spatial relationships for spawning emitters?</strong>",choices:[{text:'Use <code>Spawn Emitter Attached</code> and provide the Golem\'s mesh and a socket name as the attach point.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> The correct approach is always to attach the emitter to the skeletal mesh for reliable tracking.</p>",next:'step-7'},{text:'Set the <code>Spawn Emitter at Location</code> node to use the character\'s world <code>Root Component</code> location.',type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> This is a step up, but it still lacks the precision of a dedicated foot socket.</p>",next:'step-7'}]},

        'step-7': {isTask: true, skill:'vfx',title:'Leaking VFX Actors',prompt:"<p>The VFX plays correctly, but after a few attacks, the frame rate dips. <code>obj list class=NiagaraActor</code> shows hundreds of <code>Niagara actors</code> still in memory.</p><strong>What is causing this memory leak?</strong>",choices:[{text:"Check the <code>Spawn Emitter Attached</code> node to ensure the <code>Auto Destroy</code> checkbox is checked.",type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> The actor container must explicitly be marked for destruction via <code>Auto Destroy</code> or a manual <code>Destroy Actor</code> node after the effect is complete.</p>",next:'step-8'},{text:'Manually call <code>Destroy Actor</code> on the emitter reference after a Delay node matching the effect\'s duration.',type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> This achieves cleanup but is less efficient and more error-prone than using the built-in <code>Auto Destroy</code> flag.</p>",next:'step-8'},{text:'Reduce the particle count in the <code>Niagara System</code> to lessen memory pressure.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> This addresses symptoms but not the root cause (actor lifecycle management).</p>",next:'step-8'},{text:'Wait for the <code>Garbage Collector</code> to run; it will eventually clean up unused actors.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> The <code>Garbage Collector</code> only cleans up unreferenced memory, not actors that are still referenced or not explicitly marked for destruction.</p>",next:'step-8'}]},
        
        // === 4. MATERIAL & RENDERING OPTIMIZATION ISSUES ===
        'step-8': {isTask: true, skill:'material',title:'Unlit Gray VFX',prompt:"<p>The memory leak is fixed, but the VFX looks flat, gray, and unlit instead of a fiery explosion. The Material uses a <code>Particle Color</code> node multiplied by a texture, but the result is black (0,0,0).</p><strong>What is the best fix to correctly drive the Material?</strong>",choices:[{text:'In the Niagara emitter, add or adjust the <code>Scale Color</code> module to output the necessary color data for the Material to use.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> The Material expects particle color data, but the <code>Niagara system</code> wasn\'t providing it. Fix the data flow from the particle system to the shader.</p>",next:'step-9'},{text:"Delete the <code>Particle Color</code> node and connect the texture directly to the material's <code>Emissive</code> output.",type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> This makes it visible but removes particle system control (fading/lifetime color changes), breaking the intended look.</p>",next:'step-9'},{text:'Change the material\'s <code>Blend Mode</code> from Opaque to Additive.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> This changes the blend, but doesn\'t fix the unlit black result, and risks severe overdraw.</p>",next:'step-9'},{text:'Reimport the texture files used by the material.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> The black output is a logical flaw in the shader graph/data flow, not a texture import error.</p>",next:'step-9'}]},
        'step-9': {isTask: true, skill:'perf',title:'Overdraw Crisis (Visual Tech Debt)',prompt:"<p>You chose the <strong>Partial</strong> answer (deleting the <code>Particle Color</code> node). The VFX is now visible, but it looks terrible and performance dips because the material is set to <strong>Translucent</strong>.</p><strong>What optimization should you perform immediately to resolve the Translucent/Overdraw issue?</strong>",choices:[{text:'Change the material\'s <code>Blend Mode</code> from <code>Translucent</code> to a more performant option like <code>Additive</code> or <code>Masked</code>.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> <code>Translucency</code> is extremely costly when multiple particles overlap. Changing the blend mode fixes the overdraw issue.</p>",next:'step-10'},{text:'Reduce the size of the particle sprites in the <code>Niagara system</code>.',type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> Reduces the severity of overdraw but doesn\'t fix the fundamental performance cost of the <code>Translucent</code> blend mode.</p>",next:'step-10'},{text:'Enable the <code>Use Ray Tracing</code> flag on the material.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> <code>Ray Tracing</code> is a high-end feature that adds significant cost; it will not fix the overdraw issue.</p>",next:'step-10'},{text:'Wait for the rendering team to provide a better shader.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> Blaming another team for a basic setup error is not a solution.</p>",next:'step-10'}]},
        'step-10': {isTask: true, skill:'perf',title:'The Draw Call Spike (Mass Placement)',prompt:"<p>The lead places 50 Golems in the level for a stress test. The frame rate drops significantly, and the profiler flags <code>Draw Calls</code> and the <code>Render Thread</code> as the bottleneck.</p><strong>What common material setup is most likely causing excessive draw calls across all Golems?</strong>",choices:[{text:'Check if the Golem\'s eye glow or another feature is generating a unique <code>Dynamic Material Instance (DMI)</code> per Golem, thus breaking instancing.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> <code>DMIs</code> force unique <code>draw calls</code>, which is the classic cause of a <code>draw call spike</code> when actors should be instanced.</p>",next:'step-11'},{text:'The VFX material is still causing complexity issues.',type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> Complexity affects shader time, not <code>draw call</code> count. You misidentified the bottleneck, but the area of investigation is material related.</p>",next:'step-11'},{text:'The Golem <code>Skeletal Mesh</code> has too many material slots (<code>sub-meshes</code>).',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> This fix is misguided as the issue is DMI instantiation, not sub-mesh count.</p>",next:'step-10M'},{text:'The <code>Tick</code> function is too heavy, starving the <code>Render Thread</code>.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> The profiler points specifically to the <code>Render Thread</code>\'s <code>draw call</code> cost, not the <code>Game Thread</code>\'s <code>Tick</code> cost.</p>",next:'step-11'}]},
        
        // Dead-end: Mesh optimization doesn't fix instancing break
        'step-10M': {isTask: false, skill:'perf',title:'Merging Mesh Slots (Dead End)',prompt:"<p>You spent extended time optimizing the Golem mesh by combining its material slots (sub-meshes). While this reduced the base draw calls per Golem from 3 to 2, the **draw call spike** on the `Render Thread` persists when 50 Golems are placed.</p><strong>You realize the problem is still related to the material's instance parameters. What is the root cause?</strong>",choices:[{text:'The eye glow is generating a unique <code>Dynamic Material Instance (DMI)</code> per Golem, thus breaking instancing.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> Correctly identifying the DMI as the sole cause of the draw call spike.</p>",next:'step-11'},{text:'The mesh is using <code>World Position Offset</code>, which prevents instancing.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> <code>WPO</code> can be instanced if not using per-instance parameters. This is a common confusion point.</p>",next:'step-11'}]},

        'step-11': {isTask: true, skill:'material',title:'The DMI Refactor',prompt:"<p>You confirm the Golem's eye material uses a <code>Dynamic Material Instance (DMI)</code> to drive the 'Enraged Glow' color per instance.</p><strong>What is the best alternative to <code>DMIs</code> for performant, instance-specific material parameters?</strong>",choices:[{text:'Refactor the eye material to use a <code>Material Parameter Collection (MPC)</code>, which is a global data asset that can be updated in a single render pass.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> <code>MPCs</code> are the standard solution for globally synchronized material changes that don\'t break instancing, saving hundreds of <code>draw calls</code>.</p>",next:'step-12'},{text:'Use a <code>Per-Instance Custom Data</code> node in the material, driven by C++ code.',type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> Highly performant, but <code>MPCs</code> are generally easier to implement in <code>Blueprint-heavy</code> projects.</p>",next:'step-12'},{text:'Remove the <code>DMI</code> and simplify the material until it no longer needs instance-specific parameters.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> This forces an unnecessary design change; the requirement is to *keep* the per-instance glow but make it performant.</p>",next:'step-12'},{text:'Set the material to <code>Unlit</code>, as <code>unlit</code> materials are inherently faster to draw.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> The lit/unlit state does not affect whether the renderer can instance the material.</p>",next:'step-12'}]},
        'step-12': {isTask: true, skill:'material',title:'MPC Naming Conflict',prompt:"<p>You implement the <code>MPC</code> glow, but when you test, the Golem's eyes are always the wrong color (e.g., green) regardless of the Golem's state.</p><strong>What is the most likely cause of your <code>MPC</code> value being ignored or overwritten?</strong>",choices:[{text:'Another system in the level is also writing to the same <code>MPC</code> parameter every frame, causing a <code>naming collision</code> and overwriting your value.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> This is a classic 'battle of the systems' bug since <code>MPCs</code> are global. Parameter names must be unique to the feature.</p>",next:'step-13'},{text:"The Material assigned to the eye doesn't actually reference the <code>MPC</code>.",type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> Plausible, but the eye color would likely be default (black), not a specific wrong color like green.</p>",next:'step-13'},{text:'The Golem Blueprint is setting the <code>MPC</code> value on <code>Event BeginPlay</code>, which is too early.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> Timing is less of an issue here than the constant frame-by-frame overwrite.</p>",next:'step-13'},{text:'You must call <code>Apply Changes</code> after setting an <code>MPC</code> value.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> No such node exists; the update is immediate.</p>",next:'step-13'}]},
        
        // === 5. NETWORKING & REPLICATION ISSUES ===
        'step-13': {isTask: true, skill:'rep',title:'Multilayer Glow Failure',prompt:"<p>You rename your <code>MPC</code> parameter, and the glow works in single-player. But in multiplayer, client Golems don't glow when enraged. The server Golem glows correctly.</p><strong>What is the standard, efficient fix for replicating cosmetic state changes like the eye color?</strong>",choices:[{text:"Change the <code>IsEnraged</code> boolean variable's replication type to <code>RepNotify</code> and place the visual update logic in the generated <code>OnRep_IsEnraged</code> function.",type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> <code>RepNotify</code> is efficient, event-driven, and correctly handles late joiners by ensuring the visual update runs reliably on clients when the variable state changes.</p>",next:'step-14'},{text:'Create a <code>Multicast RPC</code> that runs the visual update logic on all clients whenever the state changes.',type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> A <code>Multicast</code> works for existing clients but fails for late joiners, who will never receive the <code>RPC</code>, causing desync.</p>",next:'step-14'},{text:'Run the visual update logic on the client\'s <code>Event Tick</code>, checking for the server-replicated variable change.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> Polling on <code>Tick</code> is highly inefficient, wasting CPU cycles checking a state that changes infrequently.</p>",next:'step-14'},{text:'Enable the "Replicates" flag on the <code>Material Parameter Collection</code> asset itself.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> Data assets do not replicate; only actors and their properties do.</p>",next:'step-14'}]},
        'step-14': {isTask: true, skill:'rep',title:'Multilayer Animation Desync',prompt:"<p>The glow replicates. However, when the Golem attacks, the server Golem plays the slam montage perfectly, but client Golems slide without the animation.</p><strong>How must the montage playback be replicated to clients?</strong>",choices:[{text:"Place the <code>Play Anim Montage</code> node inside a reliable <code>Multicast RPC</code>, ensuring all clients are explicitly told to run the cosmetic animation.",type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> One-shot cosmetic events (like Montages or <code>VFX playback</code>) must be explicitly <code>Multicast</code> to all clients, as they are not automatically replicated with movement.</p>",next:'step-15'},{text:'Change the <code>montage trigger variable</code> to a <code>RepNotify</code>.',type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> This is an indirect way that adds unnecessary state management complexity when a direct <code>Multicast RPC</code> is the cleaner pattern for one-shot events.</p>",next:'step-15'},{text:'Increase the replication rate settings on the Golem\'s <code>Skeletal Mesh Component</code>.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> Increasing the rate helps smooth movement but does not resolve the logical issue that the engine was never told to play the animation on the client.</p>",next:'step-15'},{text:'Set the <code>Anim Montage</code> asset\'s "Replicate" property to true.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> <code>Anim Montage</code> assets do not have a simple replication flag.</p>",next:'step-15'}]},
        'step-15': {isTask: true, skill:'rep',title:'Input Lockout Bug',prompt:"<p>After being attacked by the Golem, players sometimes lose the ability to jump or use their secondary attack. Their primary attack still works.</p><strong>What is the most likely cause of this partial input lockout?</strong>",choices:[{text:'A logic path is enabling a <code>Gameplay Ability</code> input or setting a <code>Gameplay Tag</code> on the character, but the corresponding disabling logic is failing to run.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> <code>Partial lockouts</code> are almost always tied to <code>Gameplay Tags</code> or the <code>Ability System</code> failing to remove an active state that is blocking specific input bindings.</p>",next:'step-16'},{text:'The <code>character movement component</code> is disabled, preventing only movement-related inputs.',type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> The primary attack works, so the <code>movement component</code> isn\'t the primary cause. The problem is selective input processing.</p>",next:'step-16'},{text:'The <code>player controller</code> is losing its input focus (<code>Unpossessed</code>).',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> If <code>unpossessed</code>, the player would lose all input, including primary attack.</p>",next:'step-16'},{text:'The <code>input mapping context</code> is corrupted.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> Corruption would cause a persistent, non-conditional failure.</p>",next:'step-16'}]},
        
        // === 6. FINAL CLEANUP & BUILD ISSUES ===
        'step-16': {isTask: true, skill:'perf',title:'Collision Snagging',prompt:"<p>QA reports one last bug: \"The Golem sometimes gets stuck on small bits of rubble on the ground.\"</p><strong>What is the first and most direct thing to check to debug character movement snagging?</strong>",choices:[{text:"Select the Golem's <code>CapsuleComponent</code> in its Blueprint and check its size and position. Use the <code>p.ShowCollision</code> console command in-game to visualize it.",type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> A character's movement is almost always governed by its root capsule. Visualizing the collision in-game is the fastest way to confirm if it\'s too wide or low.</p>",next:'step-17'},{text:"Open the Golem's <code>Physics Asset</code> and simplify the collision bodies on its legs and feet.",type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> This affects physical interactions, but the character\'s primary *movement* collision is the capsule. Check the capsule first.</p>",next:'step-17'},{text:'Increase the <code>Max Step Height</code> in the <code>Character Movement Component</code>.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> This can help the character walk over small ledges, but doesn\'t solve the problem if the capsule is fundamentally too large.</p>",next:'step-17'},{text:"Increase the Golem's mass in its <code>Character Movement Component</code>.",type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> Mass affects physics pushback, not basic collision shape for walking.</p>",next:'step-17'}]},
        'step-17': {isTask: true, skill:'material',title:'Build Packaging Failure',prompt:"<p>The Golem is now working. You start the packaging process, but it fails with an error in the log: <code>Error: Found editor-only material expression DebugFloat3Values in /Game/Golems/Materials/M_Golem_Eye. Disallowed for cook.</code></p><strong>What does this mean?</strong>",choices:[{text:'A <code>debug node</code> was left in the eye material. These nodes are not allowed in packaged builds and must be removed.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> The cooker strips out anything meant only for the editor. Leaving temporary <code>debug nodes</code> in the material graph causes this specific cook error.</p>",next:'step-18'},{text:"The material has a compile error that only shows up during cooking.",type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> It is a compile error, but the log message is very specific. It\'s not a general error, but one caused by a specific type of node.</p>",next:'step-18'},{text:'You need to install the <code>Material Debugging Utilities</code> plugin for the packaged game.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> Debugging tools are explicitly meant for the editor only.</p>",next:'step-18'},{text:'The material needs to be saved with the <code>Shipping Build</code> flag enabled.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> No such flag exists for individual material assets.</p>",next:'step-18'}]},
        'step-18': {isTask: true, skill:'material',title:'Cleaning the Shader',prompt:"<p>You remove the offending <code>debug node</code> and re-save the material. You restart the packaging process. It fails again with a different, more general error regarding the Golem mesh.</p><strong>What common material error prevents a mesh from being included in a packaged build?</strong>",choices:[{text:'The <code>Collision Hull</code> for the mesh is missing or the <code>LODs</code> were imported incorrectly, causing a <code>static mesh validation error</code> during cook.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> Complex meshes, especially <code>skeletal meshes</code>, must pass cook-time validation, which often fails due to missing <code>collision geometry</code> or malformed <code>LODs</code>.</p>",next:'conclusion'},{text:'The material is still using a <code>virtual texture asset</code>.',type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> While <code>virtual textures</code> require proper setup, this is usually a separate warning, not a hard cook failure on a <code>static mesh component</code>.</p>",next:'conclusion'},{text:'You forgot to set the <code>Skeletal Mesh Component</code> to "Hidden In Game".',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> Hiding actors does not affect cook validation.</p>",next:'conclusion'},{text:'The issue is actually with the AnimBP, which must be compiled for the target platform.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> The error points to the mesh component itself, not the <code>AnimBP</code> logic.</p>",next:'conclusion'}]}
      }
  },
  // --------------------------------------------------------------------------
  // DASH SCENARIO: Focus on Character Input, Movement, and Networking Authority
  // --------------------------------------------------------------------------
  dash: {
    meta: {
      title: "Player Dash Ability is Broken",
      description:
        "Traversal ability unresponsive. Covers input setup, cooldowns, movement, effects, and replication.",
      estimateHours: 16.0 // Adjusted for a more realistic, yet efficient, completion target
    },
    start: "step-1",
    steps:
      {
        // === 1. INPUT & CORE MECHANICS (Input Mapping, Movement, Cooldowns) ===
        'step-1': {isTask: true, skill:'input',title:'The Unresponsive Dash',prompt:"<p>You've set up an Enhanced Input Action for a player dash, but pressing the button does nothing. The <code>OnStarted</code> event never fires in your Character Blueprint.</p><strong>What is the most common reason for an Enhanced Input Action to fail?</strong>",choices:[{text:'The <code>Input Mapping Context</code> containing the dash action has not been added to the <code>Player Controller</code> at runtime.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> Enhanced Input requires you to explicitly add your mapping contexts to the player's subsystem, usually on <code>BeginPlay</code>. Without this step, the system has no registered actions to listen for.</p>",next:'step-2'},{text:'The input event is being consumed by another Blueprint.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> This is a possible issue, but the mapping context not being added is a more fundamental setup error that would prevent the input from ever being processed in the first place.</p>",next:'step-2'},{text:'The <code>Input Action</code> asset has <code>Consume Input</code> unchecked.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> This setting controls whether the input continues down the stack *after* it fires. It doesn't prevent the initial event from firing.</p>",next:'step-2'},{text:'The <code>Character Movement Component</code> is blocking the input.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> The movement component handles movement logic; it does not block raw input action events from firing.</p>",next:'step-1W'}]},
        'step-1W': {isTask: false, skill:'input',title:'Wrong Subsystem',prompt:"<p>You search your Character Blueprint's <code>BeginPlay</code> but can't find where to add the mapping context. You try adding it to the Game Instance instead, but it still doesn't work.</p><strong>Where is the correct place to add an Input Mapping Context?</strong>",choices:[{text:'Get the <code>Player Controller</code>, get its <code>Enhanced Input Local Player Subsystem</code>, and call <code>Add Mapping Context</code>.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> You've found the correct execution path. Input is managed by a player-specific subsystem, which is accessed through the <code>Player Controller</code>.</p>",next:'step-2'},{text:'Add it in the <code>Project Settings</code> under <code>Input</code>.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> That section is for the legacy input system. Enhanced Input is configured via its own assets and must be added at runtime.</p>",next:'step-2'},{text:'The <code>Level Blueprint</code> must add it for all players.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> While this might work for a single-player game, it's bad practice. Input is player-specific and should be handled in a player-specific class like the Player Controller or Pawn.</p>",next:'step-2'},{text:'You have to cast to the specific pawn from the <code>Player Controller</code> first.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> The subsystem exists on the Local Player, which is accessible directly from the Player Controller. You don't need a reference to the pawn for this step.</p>",next:'step-2'}]},
        
        // --- Core Movement Logic ---
        'step-2': {isTask: true, skill:'movement',title:'Movement Without Motion',prompt:"<p>The input now fires! Your logic calls a <code>Launch Character</code> node to propel the player forward. You use a <code>Print String</code> to confirm the node is executing, but your character doesn't move at all.</p><strong>What is the most likely reason for <code>Launch Character</code> to do nothing?</strong>",choices:[{text:'The <code>Launch Velocity</code> input is <code>(0,0,0)</code>, or the player is already moving at max speed and the current velocity is not being overridden.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> A zero-vector launch will have no effect. You must calculate a velocity based on the character's forward direction. Also, ensure the <code>XYOverride</code> and <code>ZOverride</code> booleans are checked to ignore current velocity.</p>",next:'step-3'},{text:'The <code>Character Movement Component</code> has <code>Simulate Physics</code> enabled.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> <code>Launch Character</code> is designed to work with the Character Movement Component's standard (non-physics-simulating) movement modes.</p>",next:'step-3'},{text:'The player is blocked by a small object on the floor.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> If the player were blocked, you would typically see a small nudge or collision effect. A complete lack of any motion points to a zero-velocity input.</p>",next:'step-2M'},{text:'The <code>Event Tick</code> on the character is disabled.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> <code>Launch Character</code> is an impulse and does not depend on the actor's Tick being enabled to function.</p>",next:'step-3'}]},
        
        'step-2M': {isTask: false, skill:'movement',title:'Adjusting Walk Speed (Dead End)',prompt:"<p>You decide the character is too heavy and try increasing the <code>Max Walk Speed</code> and <code>Braking Deceleration</code> on the <code>Character Movement Component</code>.</p><p>This is a dead end! <code>Max Walk Speed</code> and <code>Braking Deceleration</code> only affect ground movement and are irrelevant to the <code>Launch Character</code> node. The character still doesn't move.</p><strong>What must you check next?</strong>",choices:[{text:'Check the <code>Launch Velocity</code> input for a zero vector, and check the <code>XYOverride</code>/<code>ZOverride</code> booleans.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> Returning to the core issue. The problem is with the launch parameters, not the character's standard locomotion settings.</p>",next:'step-3'},{text:'Delete the <code>Launch Character</code> node and replace it with <code>Add Force</code>.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> <code>Add Force</code> requires simulating physics and is completely inappropriate for Character movement.</p>",next:'step-3'},{text:'Check if the character\'s mesh has <code>No Collision</code> set.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> Collision prevents motion, but not *absence* of motion. You are wasting time on unrelated settings.</p>",next:'step-3'}]},

        // --- Cooldown and Resource Management ---
        'step-3': {isTask: true, skill:'systems',title:'Infinite Dashes',prompt:"<p>You fix the velocity calculation and the dash works! However, the player can spam the dash button infinitely without any limitation. The dash is supposed to have a 2-second cooldown.</p><strong>What is the standard way to implement a cooldown for an ability?</strong>",choices:[{text:'Use a boolean like <code>bIsDashOnCooldown</code>, set it to true after dashing, and use a <code>Set Timer by Event</code> node with a 2-second delay to call an event that sets it back to false.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> This is a robust and common pattern. The boolean acts as a gate for the ability, and the timer reliably re-opens the gate after the specified duration.</p>",next:'step-4'},{text:'On dash, record the <code>Get Game Time in Seconds</code> and, on the next attempt, check if the current time is greater than the recorded time plus 2.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> This works, but it's less efficient than a timer because it requires you to run this check every time the input is pressed. The boolean gate is a cleaner, more performant approach.</p>",next:'step-4'},{text:'Add a <code>Delay</code> node for 2 seconds at the end of the dash logic.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> This is a critical error. A Delay node will freeze the entire execution chain. If the player presses the button during the delay, the input will be ignored. It does not prevent the initial logic from running again.</p>",next:'step-4'},{text:'Create a <code>Timeline</code> that is 2 seconds long and only allow dashing when it is finished.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> Timelines are for updating values over time (like a fade or a pulse), not for simple cooldown timers. A Timer is the correct and more lightweight tool for this job.</p>",next:'step-4'}]},
        'step-4': {isTask: true, skill:'systems',title:'Free Stamina',prompt:"<p>The cooldown works. Now, the dash is supposed to cost 25 stamina, but the player's stamina bar doesn't decrease. You have a \"Stamina\" float variable on your Character Blueprint.</p><strong>The dash logic includes a node that subtracts 25 from the \"Stamina\" variable. Why might the value not be changing?</strong>",choices:[{text:'The logic checks if the player has <strong>enough</strong> stamina <strong>before</strong> subtracting, but the initial check is failing, preventing the subtraction from ever running.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> This is a common logic flow error. You put a guard clause (e.g., <code>Branch: Stamina >= 25</code>) at the start, but if the player's stamina is, for example, 24.9, the subtraction logic is never reached.</p>",next:'step-5'},{text:'The <code>Stamina</code> variable is not marked as <code>Instance Editable</code>.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> This setting only affects whether you can change the variable's default value from the level editor. It has no impact on changing the value at runtime via Blueprint nodes.</p>",next:'step-5'},{text:'The subtraction is happening, but another node on <code>Event Tick</code> is resetting the stamina back to full every frame.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> This is a plausible and frustrating bug, but it's a good practice to first check the logic immediately surrounding the ability call before hunting for unrelated logic on the Tick event.</p>",next:'step-5'},{text:'You are trying to subtract from a local variable that was copied from the real Stamina variable, instead of the actual class member variable.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> While this is a common error in text-based programming, in Blueprints you typically drag the variable directly from the \"My Blueprint\" panel, ensuring you're modifying the correct one.</p>",next:'step-5'}]},
        
        // === 2. VFX, SOUND, & CAMERA ISSUES (Cosmetics) ===
        'step-5': {isTask: true, skill:'vfx',title:'The Silent Whoosh',prompt:"<p>The stamina cost is now correctly applied. A 'whoosh' sound is supposed to play during the dash via a <code>Play Sound at Location</code> node. The node is executing, but no sound is heard.</p><strong>What is the most fundamental reason for this node to fail to produce sound?</strong>",choices:[{text:'The <code>Sound</code> input pin on the node is not assigned to a <code>Sound Wave</code> or <code>Sound Cue</code> asset.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> Just like many other nodes, if the primary asset input is <code>None</code>, the node will execute silently but do nothing. This is always the first thing to check.</p>",next:'step-6'},{text:'The <code>Location</code> input is <code>(0,0,0)</code> and the player is far away from the world origin.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> This would also result in silence, but a missing sound asset is a more common and basic setup error.</p>",next:'step-6'},{text:"The sound's <code>Attenuation</code> settings have a radius of zero.",type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> This is a plausible cause, but it's a data issue within the sound asset itself. You should first verify that the Blueprint node is even configured with an asset to play.</p>",next:'step-6'},{text:'You are using <code>Play Sound at Location</code> instead of <code>Play Sound 2D</code>.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> A dash sound is spatialized and should emanate from the player, so <code>Play Sound at Location</code> is the correct node to use. <code>Play Sound 2D</code> is for non-spatial UI sounds.</p>",next:'step-6'}]},
        'step-6': {isTask: true, skill:'vfx',title:'The Invisible Trail',prompt:"<p>The dash sound now plays correctly. A Niagara particle system is supposed to create a trail effect, but no particles appear. You've added a Niagara Component to your Character Blueprint.</p><strong>What is the most common reason for a Niagara Component to not play its effect at runtime?</strong>",choices:[{text:'The component\'s <code>Auto Activate</code> property is set to false, and you have not explicitly called the <code>Activate</code> node on the component in your dash logic.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> For performance, it's common practice to disable auto-activation for effects that only play on demand. You must manually trigger them with an <code>Activate</code> node when the ability is used.</p>",next:'step-7'},{text:'The Niagara System asset itself has a compile error.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> This is possible, but you should always check your Blueprint activation logic first. A missing <code>Activate</code> call is far more common than a broken asset.</p>",next:'step-7'},{text:'The material used by the particles is transparent, making them invisible.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> While a bad material could cause issues, it's highly unlikely to be completely invisible. It's more probable that the system isn't being told to run at all.</p>",next:'step-7'},{text:'The <code>Niagara Component</code> must be the root component of the <code>Blueprint</code>.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> Particle components are meant to be attached to other components (like the character's mesh) and should almost never be the root.</p>",next:'step-7'}]},
        
        // === 3. NETWORKING & REPLICATION ISSUES (Cosmetics & Authority) ===
        'step-7': {isTask: true, skill:'rep',title:'The Invisible Dash',prompt:"<p>The dash now works perfectly for you. In multiplayer, however, you can see your own dash effect, but you can't see other players dashing. They just teleport from point A to B.</p><strong>Why are the cosmetic parts of the dash (sound, VFX) not visible on other clients?</strong>",choices:[{text:'The events that trigger the cosmetics are only running on the server and the local client. They need to be called from a <code>Multicast</code> RPC to execute on all clients.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> The server handles the authoritative movement (the teleport), which everyone sees. But cosmetic effects must be explicitly told to play for all observers via a Multicast event.</p>",next:'step-8'},{text:'The <code>Niagara System</code> asset needs its <code>Replicates</code> flag checked.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> Assets do not have replication flags. Their *execution* must be controlled by replicated logic.</p>",next:'step-8'},{text:'The other clients are too far away to see the effect.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> This is a logic replication issue, not a distance or culling problem. The clients are not being told to play the effect at all.</p>",next:'step-8'},{text:'The logic should be in a <code>Run on Owning Client</code> RPC instead.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> This would make the effect visible to the player who is dashing (which it already is), but other players still wouldn't see it. A Multicast is needed to show it to everyone.</p>",next:'step-8'}]},
        
        // --- Movement Authority and Synchronization ---
        'step-8': {isTask: true, skill:'rep',title:'The Snap-Back',prompt:"<p>You've multicast the cosmetic effects. Now, clients report that when they dash, they move smoothly for a moment and then snap back to their starting position.</p><strong>What causes this classic client-server desynchronization?</strong>",choices:[{text:"The dash logic (e.g., <code>Launch Character</code>) is only being executed on the client. The server, which has authority, doesn't know the dash occurred and corrects the client's position.",type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> This is a fundamental networking concept. Any action that changes an actor's position must be executed on the server. The client's input should trigger a <code>Run on Server</code> RPC that contains the movement logic.</p>",next:'step-9'},{text:'The client\'s network connection is lagging.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> Lag will make the snap-back more noticeable, but the root cause is the logical error of not running the movement code on the server.</p>",next:'step-9'},{text:'The <code>Character Movement Component</code> has <code>Allow Client-Side Prediction</code> disabled.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> Client-side prediction is what allows clients to feel responsive. You try enabling it to fix the snap-back.</p>",next:'step-8M'},{text:'The Multicast event for the VFX is interfering with the movement.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> Cosmetic events and character movement are handled by separate systems and do not interfere with each other. This is a complete distraction.</p>",next:'step-8W'}]},
        
        // Dead-end: Client Prediction Failure
        'step-8M': {isTask: false, skill:'rep',title:'Client Prediction Failure (Dead End)',prompt:"<p>You enabled <code>Allow Client-Side Prediction</code>, but the character still snaps back. Client-side prediction helps smooth *movement interpolation*, but it relies on the server validating and accepting the input, which isn't happening because the dash isn't running on the server.</p><strong>What is the next logical step to ensure the dash is acknowledged by the server?</strong>",choices:[{text:'The client\'s input must trigger a <code>Run on Server</code> RPC that contains the movement logic.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> You correctly identified the need for server authority over movement, not just client-side prediction.</p>",next:'step-9'},{text:'Check the <code>Is Authority</code> node before the launch and branch the logic.',type:'partial',feedback:"<p><strong>Standard Time Logged:</strong> Checking authority is often a good practice, but it doesn't solve the core problem of getting the client input to execute the authoritative action on the server.</p>",next:'step-9'},{text:'Increase the <code>Network Update Frequency</code> on the character.',type:'misguided',feedback:"<p><strong>Extended Time Logged (Investigation):</strong> This just increases the rate of the snap-back, not preventing the server from correcting the move.</p>",next:'step-9'}]},
        
        // Dead-end: Irrelevant Authority Check
        'step-8W': {isTask: false, skill:'rep',title:'Irrelevant Authority Check (Dead End)',prompt:"<p>You waste time checking the relationship between the cosmetic multicast and character movement. This is a false lead; they are handled separately.</p><strong>What fundamental networking principle are you overlooking regarding player movement?</strong>",choices:[{text:"The client's input must trigger a <code>Run on Server</code> RPC that contains the movement logic.",type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> Client-driven movement must always be executed by the server to maintain network authority and synchronization.</p>",next:'step-9'},{text:'Check the <code>Is Valid</code> node before the launch and branch the logic.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> Irrelevant to network authority.</p>",next:'step-9'},{text:'Increase the size of the <code>Replicated Movement</code> property struct.',type:'wrong',feedback:"<p><strong>Maximum Time Logged (Ineffective Fix):</strong> Incorrectly looking for a setting that doesn't exist to solve a logic error.</p>",next:'step-9'}]},

        // === 4. ANIMATION & COLLISION REFINEMENT ===
        'step-9': {isTask: true, skill:'collision',title:'Dashing Through Walls',prompt:"<p>You've moved the dash logic to a server RPC and it replicates correctly. However, QA reports that if they dash at a thin wall, they sometimes pass right through it.</p><strong>What feature of the Character Movement Component is designed to prevent this?</strong>",choices:[{text:'Enabling <code>Sweep</code> on the movement call (e.g., <code>Set Actor Location</code>) or using a movement component function that sweeps automatically, like <code>Add Movement Input</code>.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> A 'teleport' without a sweep will not check for collisions between the start and end points. Enabling sweeping treats the movement as a continuous motion and respects collision, preventing tunneling.</p>",next:'step-10'},{text:'Increasing the character\'s capsule radius.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> While a larger capsule makes collision more likely, it doesn't solve the underlying issue of teleporting through objects without checking the path taken.</p>",next:'step-10'},{text:'Enabling <code>Continuous Collision Detection</code> (CCD) on the capsule component.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> CCD is for physics-simulating objects to prevent tunneling at high speeds. For Character Movement, which is not a true physics simulation, sweeping is the correct and more performant solution.</p>",next:'step-10'},{text:'Increasing the mass of the character.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> Mass has no effect on the kinematic movement of the Character Movement Component.</p>",next:'step-10'}]},
        'step-10': {isTask: true, skill:'animation',title:'The Static Dash',prompt:"<p>The dash is mechanically sound. Now for the animation. You have a dash animation montage, but when you call <code>Play Anim Montage</code>, the character remains in their idle/run pose.</p><strong>What is a common setup error that prevents an Anim Montage from playing?</strong>",choices:[{text:"The <code>Anim BP's AnimGraph</code> is missing a <code>Slot</code> node. Montages need a named slot to play into, which overrides the base animation from the state machine.",type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> The <code>AnimGraph</code> is a flow of poses. A <code>Slot</code> node acts as an injection point where a montage can temporarily take over the final animation pose.</p>",next:'step-11'},{text:'The montage asset has not been saved.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> An unsaved asset would likely result in a <code>None</code> reference and a warning in the output log. If the node is executing without warnings, the problem is likely in the Anim BP setup.</p>",next:'step-11'},{text:'The character is not in the correct <code>Movement Mode</code> (e.g., <code>Falling</code>).',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> Montages can be played regardless of the character's movement mode.</p>",next:'step-11'},{text:'You must use <code>Play Animation</code> instead of <code>Play Anim Montage</code>.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> <code>Play Animation</code> is for simple, single-asset playback. Montages are specifically designed for layered, temporary animations like attacks or abilities, and <code>Play Anim Montage</code> is the correct node.</p>",next:'step-11'}]},
        'step-11': {isTask: true, skill:'animation',title:'The Blending Snap',prompt:"<p>You add a Slot node and the dash montage now plays. However, it snaps into the animation and snaps back out instantly, which looks very jarring.</p><strong>What controls the smooth transition into and out of a montage?</strong>",choices:[{text:'The <code>Blend In</code> and <code>Blend Out</code> time settings within the <code>Anim Montage</code> asset itself.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> These properties, found in the montage's details panel, control the duration over which the engine will interpolate from the base animation pose to the montage pose, and vice-versa.</p>",next:'step-12'},{text:'The <code>Interpolation</code> settings on the <code>Blendspace</code> used in the <code>State Machine</code>.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> Blendspace interpolation affects transitions *within* the state machine (e.g., from idle to run), not how a montage blends on top of it.</p>",next:'step-12'},{text:'A "Montage Blend" node in the Anim BP event graph.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> No such node exists. Blending is controlled by the montage asset's data.</p>",next:'step-12'},{text:'The <code>Play Rate</code> input on the <code>Play Anim Montage</code> node.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> Play Rate controls the speed of the animation's playback, not the smoothness of the transition into it.</p>",next:'step-12'}]},
        'step-12': {isTask: true, skill:'animation',title:'The Root Motion Problem',prompt:"<p>The blending is now smooth. However, the dash is now moving the player almost twice as far as intended. It seems like two systems are applying motion.</p><strong>What is the cause of this \"double movement\"?</strong>",choices:[{text:'The animation has <code>Root Motion</code>, and you are also applying movement with a <code>Launch Character</code> node. You should do one or the other, not both.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> <code>Root Motion</code> extracts movement from the animation itself and applies it to the character. If you're also applying a manual launch, you're applying two sources of velocity. You should either disable <code>Root Motion</code> or remove the <code>Launch Character</code> call.</p>",next:'step-13'},{text:'The animation\'s <code>Play Rate</code> is set to 2.0.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> A faster play rate would make the animation finish faster, but it wouldn't double the distance of a separate <code>Launch Character</code> call.</p>",next:'step-13'},{text:'The server is correcting the client\'s position, causing an overshoot.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> A server correction would typically cause a snap-back, not a consistent doubling of movement distance.</p>",next:'step-13'},{text:'The character\'s <code>Max Walk Speed</code> is too high.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> Max Walk Speed applies to standard ground movement and does not affect the velocity applied by a launch or root motion.</p>",next:'step-13'}]},
        
        // --- UI & Rendering Polish ---
        'step-13': {isTask: true, skill:'ui',title:'Stale Stamina Bar',prompt:"<p>You decide to use <code>Launch Character</code> and disable <code>Root Motion</code>. The movement is now correct. However, the UI's stamina bar does not update immediately after a dash. It only updates after the next time the player jumps or sprints.</p><strong>What causes this kind of delayed UI update?</strong>",choices:[{text:'The UI is not being notified of the change. The stamina bar\'s value is probably only being updated by other events (like jumping) and not by the dash event.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> This indicates that your UI update logic is not centralized. A robust solution is to use an <code>Event Dispatcher</code> or an <code>interface call</code> whenever stamina changes, which the UI can bind to and update itself accordingly.</p>",next:'step-14'},{text:'The stamina bar widget has <code>Is Volatile</code> set to false.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> <code>Is Volatile</code> forces the widget to be redrawn every frame, which is bad for performance and doesn't solve the underlying problem that the data it's trying to draw is stale.</p>",next:'step-14'},{text:'The widget has its <code>Tick</code> disabled.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> While you could update the UI on Tick, this is inefficient (\"polling\"). An event-driven approach where the UI is told when to update is far better.</p>",next:'step-14'},{text:'The player\'s stamina variable is not replicated.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> If the variable isn't replicated, clients' UI would be out of sync with the server. However, the problem describes a delayed update even for the local player, which points to a logic flow issue, not a replication one.</p>",next:'step-14'}]},
        'step-14': {isTask: true, skill:'render',title:'The Missing Blur',prompt:"<p>The dash is supposed to trigger a radial blur Post Process effect. You have a Post Process Component on your character, and your logic is setting its parameters, but nothing happens to the screen.</p><strong>Why would setting parameters on a Post Process Component have no visible effect?</strong>",choices:[{text:'The component is not enabled. You need to set its <code>Enabled</code> property to true at the start of the dash and false at the end.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> Just like particle systems, Post Process Components can be enabled and disabled for performance. Simply changing their parameters won't do anything if the component itself is not active.</p>",next:'step-15'},{text:'The <code>Blend Weight</code> of the component is set to 0.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> A blend weight of 0 would also make the effect invisible. However, the enabled/disabled state is a more common and fundamental gate for the entire component's influence.</p>",next:'step-15'},{text:'The level already has an Unbound <code>Post Process Volume</code> with a higher priority.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> While priority matters for blending, even a low-priority component would have *some* visible effect unless its blend weight was zero or it was disabled.</p>",next:'step-15'},{text:'The material used for the effect has a compile error.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> A material error would likely show up as the default grid material on screen, not a complete lack of any effect.</p>",next:'step-15'}]},
        'step-15': {isTask: true, skill:'camera',title:'The Static Camera',prompt:"<p>The dash is supposed to briefly increase the camera's Field of View (FOV) for a sense of speed. Your logic calls <code>Set Field of View</code> on the player's camera, but the FOV remains unchanged.</p><strong>What is the most likely reason the camera's properties are not being updated?</strong>",choices:[{text:'You are getting a reference to the wrong camera. You might be modifying the default Camera Component instead of the active one, especially if you are using a system like a spring arm.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> A common error is to have multiple camera components (e.g., one for first-person, one for third-person) and get a reference to the inactive one. You must ensure you are targeting the currently active player camera.</p>",next:'step-16'},{text:'The <code>Camera Manager</code> is overriding your settings.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> The Player Camera Manager is the final authority on camera settings. If it's running a camera shake or another effect, it could be overwriting your FOV change. However, getting a bad reference to the camera itself is a more basic error.</p>",next:'step-16'},{text:'The "Lock Camera" setting is enabled on the character.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> No such setting exists. Camera control is managed through the Player Controller and Camera Manager.</p>",next:'step-16'},{text:'You cannot change the <code>FOV</code> at runtime; it must be set in the <code>Blueprint</code> defaults.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> The FOV is designed to be changed dynamically at runtime for effects like sprinting, aiming, and dashing.</p>",next:'step-16'}]},
        
        // === 5. COLLISION, PHYSICS & MOVEMENT REFINEMENT ===
        'step-16': {isTask: true, skill:'physics',title:'The Immovable Crate',prompt:"<p>Dashing into a physics-simulating crate is supposed to send it flying. Instead, it just stops your dash. Your overlap logic calls an <code>Add Impulse</code> node on the crate.</p><strong>Why would <code>Add Impulse</code> fail to move an object that is simulating physics?</strong>",choices:[{text:'The impulse strength is too low compared to the mass of the object, or the crate has its <code>Lock Position</code> constraint enabled in its physics settings.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> Physics calculations are a balance of forces. If the impulse is too weak or the object's mass is astronomical, there will be no visible movement. Locked constraints would also prevent any movement.</p>",next:'step-17'},{text:'The <code>Velocity Change</code> boolean on the <code>Add Impulse</code> node is unchecked.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> Checking this box makes the impulse ignore the object's mass, which can be a good way to guarantee movement. However, the root cause is still likely an imbalance of mass and force.</p>",next:'step-17'},{text:'The crate is not a child of a Voxel Physics object.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> This is not a concept in standard Unreal Engine physics. Any component with <code>Simulate Physics</code> enabled can receive an impulse.</p>",next:'step-17'},{text:'The server is rejecting the physics interaction.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> While physics replication can be complex, a basic impulse call that fails to move an object locally points to a physics properties issue, not a networking one.</p>",next:'step-17'}]},
        'step-17': {isTask: true, skill:'collision',title:'Dashing Off Ledges',prompt:"<p>A new design requires an aerial dash. If the player dashes while in the air, they should move forward, not fall. Currently, they dash forward but still fall due to gravity.</p><strong>What setting in the <code>Launch Character</code> node can be used to achieve this?</strong>",choices:[{text:'Check the <code>Z Override</code> boolean. This will make the Z component of your launch velocity replace the character\'s current vertical velocity (i.e., gravity).',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> This is precisely what Z Override is for. By providing a Z velocity of 0 and overriding, you are effectively canceling out gravity for the duration of the launch, resulting in a horizontal air dash.</p>",next:'step-18'},{text:'Set the <code>Character Movement Component\'s Gravity Scale</code> to 0 before the dash.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> This would work, but it's a \"leaky\" abstraction. You would need to remember to set it back to 1.0 after the dash. The <code>Launch Character</code> node's built-in override is a cleaner, more self-contained solution.</p>",next:'step-18'},{text:'Set the <code>Movement Mode</code> to <code>Flying</code> before the dash.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> While this would negate gravity, it's a heavy-handed state change that has many other side effects. It's not the intended way to implement an air dash.</p>",next:'step-18'},{text:'The Z value of the <code>Launch Velocity</code> needs to be a large positive number.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> This would launch the character upwards, not create a level horizontal dash. To cancel falling, you need to override the existing downward velocity.</p>",next:'step-18'}]},
        'step-18': {isTask: true, skill:'systems',title:'Dashing While Stunned',prompt:"<p>The player can still dash even when a 'stunned' gameplay effect is active. The stun effect is supposed to block all abilities.</p><strong>What is the best-practice way to have systems like stuns block abilities like the dash?</strong>",choices:[{text:'Use <code>Gameplay Tags</code>. The stun effect should grant the player a <code>State.Stunned</code> tag, and the dash ability logic should have a check for <code>Has Tag: State.Stunned</code> at the very beginning.',type:'correct',feedback:"<p><strong>Optimal Time Logged:</strong> <code>Gameplay Tags</code> are the ideal, data-driven way to manage states and abilities. It's scalable, decoupled, and makes it easy to see what states an actor is in and what abilities are blocked by those states.</p>",next:'step-19'},{text:'Create a <code>bIsStunned</code> boolean on the Player Character and check it before dashing.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> This works for one or two states, but it's not scalable. What if you add a \"rooted\" state, a \"silenced\" state, etc.? You'll end up with a messy pile of booleans. Tags are designed to solve this problem cleanly.</p>",next:'step-19'},{text:'From the stun logic, call <code>Disable Input</code> on the <code>Player Controller</code>.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> This is a sledgehammer approach. It would block *all* input, including looking around or opening the menu. A proper stun should only block specific actions, which tags allow you to do.</p>",next:'step-19'},{text:'The dash logic should get all actors with a "stun" component and check if the player is one of them.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> This inverts the dependency and is very inefficient. The player should know their own state; they shouldn't have to search the entire world to find out if they are stunned.</p>",next:'step-19'}]},
        'step-19': {isTask: true, skill:'collision',title:'The Trace Check',prompt:"<p>To prevent dashing into walls, you add a capsule trace before the launch to see if the path is clear. However, the trace immediately hits your own character, and the dash always fails.</p><strong>How do you prevent a trace from hitting the actor that initiated it?</strong>",choices:[{text:'Add your character to the <code>Actors to Ignore</code> array pin on the trace node.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> This is the most direct and explicit way to solve the problem. The trace will then ignore the specified actor and correctly check the environment beyond it.</p>",next:'step-20'},{text:'In your character\'s collision settings, set the <code>Trace Response</code> channel to <code>Ignore</code>.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> This would make your character ignore *all* traces of that type, which could have unintended side effects for other systems (like AI visibility checks or weapon targeting).</p>",next:'step-20'},{text:'Set the <code>Trace Complexity</code> to <code>Simple Collision</code>.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> This determines whether the trace uses the simple physics body or the complex per-poly mesh. It doesn't affect which actors are hit.</p>",next:'step-20'},{text:'Start the trace from a location far in front of the character.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> This is a common but flawed workaround. It creates a \"dead zone\" right in front of the player where obstacles won\'t be detected. Using \"Actors to Ignore\" is the correct solution.</p>",next:'step-20'}]},
        
        // === 6. PERFORMANCE & FINAL GAS REFACTOR ===
        'step-20': {isTask: true, skill:'perf',title:'The Cost of Dashing',prompt:"<p>The game runs smoothly, but a profiler reveals that every time a dash occurs, there is a small but noticeable garbage collection (GC) hitch. The dash logic itself doesn't seem to be creating actors.</p><strong>What non-obvious part of Blueprint can create objects and trigger GC?</strong>",choices:[{text:'Using <code>Format Text</code> nodes or string <code>Append</code> nodes. These create new <code>FString</code> objects in memory that the garbage collector eventually needs to clean up.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> This is a common hidden performance cost. For frequently updated debug text or UI, these nodes can generate a lot of temporary string objects. In performance-critical code, it's better to avoid them.</p>",next:'step-21'},{text:'Calling a pure function.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> Pure functions are just functions that don't modify state; they do not inherently create objects or cause GC hitches.</p>",next:'step-21'},{text:'Using a <code>For Each Loop</code> node.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> Loops iterate over existing memory; they do not allocate new objects for each iteration.</p>",next:'step-21'},{text:'Creating a local variable inside a function.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> Local variables are allocated on the stack and are cleaned up when the function returns. They are not managed by the garbage collector and do not cause GC hitches.</p>",next:'step-21'}]},
        'step-21': {isTask: true, skill:'audio',title:'The Abrupt Sound Cutoff',prompt:"<p>The dash sound effect has a nice, fading tail. However, if the player dashes again quickly, the tail of the previous sound cuts off instantly to play the new one.</p><strong>How do you allow multiple instances of a sound to overlap and play out fully?</strong>",choices:[{text:'In the <code>Sound Cue</code> or <code>Sound Wave</code> asset, adjust the <code>Concurrency</code> settings to allow more than one instance of the sound to play at once.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> Concurrency settings manage how many instances of a sound can be active. By increasing the \"Max Count\", you allow new sounds to play without stopping the old ones.</p>",next:'step-22'},{text:'Use "Spawn Sound Attached" instead of "Play Sound at Location".',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> Both nodes are affected by the asset's concurrency settings. Changing the node won't solve the underlying data limitation.</p>",next:'step-22'},{text:'Add a <code>Fade Out</code> node before playing the new sound.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> This would make the problem sound smoother, but it wouldn't solve the core issue of allowing the sounds to overlap naturally.</p>",next:'step-22'},{text:'In the <code>Project Settings</code>, increase the <code>Max Audio Channels</code>.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> While a very low number of max channels could cause sounds to be culled, the Concurrency setting on the asset itself is the direct and intended control for this specific behavior.</p>",next:'step-22'}]},
        
        // --- Gameplay Ability System (GAS) Conversion ---
        'step-22': {isTask: true, skill:'systems',title:'The State Machine Conflict (GAS)',prompt:"<p>You refactor your dash logic to use a Gameplay Ability from the Gameplay Ability System (GAS). When you try to activate the ability, it fails silently.</p><strong>What is a common reason for a Gameplay Ability to fail to activate?</strong>",choices:[{text:'The ability is being blocked by another tag. The <code>Blocked by Tags</code> property on the ability is preventing it from running while the character has a tag like <code>State.Sprinting</code>.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> <code>GAS</code> uses <code>Gameplay Tags</code> extensively for control flow. An ability can have tags that block it, and it can be blocked by tags that the character currently possesses. This is the first place to check for an activation failure.</p>",next:'step-23'},{text:'The <code>Ability System Component</code> is not on the <code>Player State</code>.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> While the ASC is often on the Player State, it can also be on the Character. The location of the component is less likely to be the issue than a tag conflict.</p>",next:'step-23'},{text:'The ability has no "Cost" Gameplay Effect.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> An ability does not need to have a cost to be activated.</p>",next:'step-23'},{text:'The <code>Try Activate Ability by Class</code> node is bugged.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> This node is the standard way to activate abilities and is very reliable. The failure is almost certainly in your data setup (tags, costs, cooldowns), not the node itself.</p>",next:'step-23'}]},
        'step-23': {isTask: true, skill:'systems',title:'The Unapplied Cooldown (GAS)',prompt:"<p>Your dash ability now activates through GAS. However, the cooldown isn't working. The ability can be spammed. You have a \"Cooldown\" Gameplay Effect specified in the ability's details.</p><strong>Why would a Cooldown Gameplay Effect fail to apply?</strong>",choices:[{text:'The <code>Gameplay Effect\'s</code> duration is set to <code>Instant</code> instead of <code>Has Duration</code>. A cooldown must have a duration to be effective.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> An instant Gameplay Effect applies and is immediately removed. For a cooldown, the effect must be applied to the character for a set duration, during which it grants a tag that blocks the ability.</p>",next:'step-24'},{text:'The <code>Gameplay Effect</code> is missing a <code>Magnitude</code> modifier.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> Magnitude is for how much an attribute is changed (e.g., damage amount). It is irrelevant for a simple cooldown tag.</p>",next:'step-24'},{text:'The <code>Cooldown Tags</code> in the ability are not set correctly.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> The ability needs to check for the cooldown tag granted by the effect. However, if the effect itself isn't applying correctly (due to being Instant), this check doesn't matter.</p>",next:'step-24'},{text:'The server is not authoritative over the Gameplay Effect.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> By default, Gameplay Effects are handled authoritatively by the server. This is not something you would typically configure incorrectly.</p>",next:'step-24'}]},
        
        // --- Final Build and Polish ---
        'step-24': {isTask: true, skill:'build',title:'The Cooker Warning',prompt:"<p>You are packaging a build and see a warning in the log: <code>LogCook: Warning: /Game/Characters/BP_PlayerCharacter references /Game/UI/WBP_DebugHUD. WBP_DebugHUD is an editor-only asset and will not be cooked.</code> The build succeeds, but you're concerned.</p><strong>What is the best way to fix this?</strong>",choices:[{text:'Wrap the logic that creates the debug widget in a <code>Is Standalone Screen</code> or <code>Is With Editor</code> macro node to ensure it only runs in editor builds.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> These macro nodes are specifically designed to strip out editor-only logic from packaged builds, which resolves the warning and prevents potential errors in the shipped game.</p>",next:'step-25'},{text:'Delete the debug widget logic entirely.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> The debug widget is likely useful for development. Removing it completely is a short-sighted fix. The goal is to keep it for developers but exclude it for players.</p>",next:'step-25'},{text:'Move the debug widget to the "Developer" content folder.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> This can help organize assets, and some cooker settings can be configured to exclude developer folders. However, using the editor-only macros is a more explicit and reliable way to control the logic flow.</p>",next:'step-25'},{text:'Ignore the warning, since the build succeeded.',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> A successful build with cooking warnings is not a clean build. This warning indicates that a reference will be <code>None</code> in the packaged game, which could lead to a crash if not handled properly.</p>",next:'step-25'}]},
        'step-25': {isTask: true, skill:'perf',title:'The Final Polish',prompt:"<p>The dash is feature-complete. The last piece of feedback is that the stop feels 'floaty'. The player continues to slide for a moment after the dash velocity is applied.</p><strong>What property in the Character Movement Component controls how quickly a character comes to a stop?</strong>",choices:[{text:'<code>Braking Deceleration Walking</code>. Increasing this value will make the character decelerate faster, resulting in a tighter, more responsive stop.',type:'correct',feedback:"<p><strong>Correct (+5 points):</strong> This is the direct physics-based property that controls friction and braking force on the ground. Tuning this value is key to achieving the desired game feel for movement.</p>",next:'conclusion'},{text:'<code>Max Acceleration</code>.',type:'misguided',feedback:"<p><strong>Misguided (+0 points):</strong> This controls how quickly the character gets *up to* max speed, not how quickly they stop.</p>",next:'conclusion'},{text:'"Mass".',type:'wrong',feedback:"<p><strong>Wrong (+0 points):</strong> Mass is not used for the standard kinematic movement calculations in the Character Movement Component. It only comes into play when being pushed by external physical forces.</p>",next:'conclusion'},{text:'<code>Use Separate Braking Friction</code>.',type:'partial',feedback:"<p><strong>Partially Correct (+2 points):</strong> This boolean enables a separate friction value for braking, but the <code>Braking Deceleration</code> is the actual value that needs to be tuned.</p>",next:'conclusion'}]}
      }
  },

};