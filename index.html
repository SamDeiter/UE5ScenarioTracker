<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UE5 Scenario Tracker</title>
    <!-- Hub Gatekeeper (Auth & Access Check) -->
    <script src="https://samdeiter.github.io/Reviewport/gatekeeper.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              // UE5 Background Colors
              "ue-darkest": "var(--ue-bg-darkest)",
              "ue-darker": "var(--ue-bg-darker)",
              "ue-dark": "var(--ue-bg-dark)",
              "ue-medium": "var(--ue-bg-medium)",
              "ue-lighter": "var(--ue-bg-lighter)",
              "ue-code": "var(--ue-bg-code)",
              // UE5 Border Colors
              "ue-border-dark": "var(--ue-border-dark)",
              "ue-border-base": "var(--ue-border-base)",
              "ue-border-hover": "var(--ue-border-hover)",
              // UE5 Text Colors
              "ue-text-primary": "var(--ue-text-primary)",
              "ue-text-secondary": "var(--ue-text-secondary)",
              "ue-text-tertiary": "var(--ue-text-tertiary)",
              "ue-text-muted": "var(--ue-text-muted)",
            },
            boxShadow: {
              "ue-neutral-glow": "0 0 15px var(--ue-neutral-glow)",
              "ue-success-glow": "0 0 15px 4px var(--ue-success-glow)",
            },
            typography: {
              DEFAULT: {
                css: {
                  color: "var(--ue-text-tertiary)",
                  strong: {
                    color: "var(--ue-text-primary)",
                    fontWeight: "700",
                  },
                  code: {
                    color: "var(--ue-text-secondary)",
                    backgroundColor: "var(--ue-bg-code)",
                    padding: "2px 6px",
                    borderRadius: "4px",
                    fontWeight: "400",
                  },
                  "code::before": {
                    content: '""',
                  },
                  "code::after": {
                    content: '""',
                  },
                },
              },
              invert: {
                css: {
                  color: "var(--ue-text-tertiary)",
                  strong: {
                    color: "var(--ue-text-primary)",
                  },
                },
              },
            },
          },
        },
      };
    </script>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body
    class="text-neutral-200 font-sans antialiased min-h-screen flex flex-col"
  >
    <!-- Main Game -->
    <main
      id="game-container"
      class="flex-grow p-4 md:p-8 flex flex-col items-center"
    >
      <!-- Header with UE5 Branding & Controls -->
      <div
        class="w-full max-w-7xl mb-4 flex justify-between items-center flex-wrap gap-4 assessment-header p-4 rounded-lg"
      >
        <div class="flex items-center gap-4">
          <!-- UE5 Logo -->
          <img
            src="assets/icons/UE-Secondary-Logo-2023-Horizontal-White.svg"
            alt="Unreal Engine"
            class="h-8"
          />
          <span class="text-neutral-600">|</span>
          <div>
            <h1 class="text-xl font-bold text-neutral-100">
              Competency Evaluation
            </h1>
            <span class="text-xs text-neutral-500 uppercase tracking-wider"
              >Technical Assessment</span
            >
          </div>
        </div>

        <!-- Category Filter Dropdown -->
        <div class="flex items-center gap-3">
          <label for="category-filter" class="text-sm text-neutral-400"
            >Filter:</label
          >
          <select
            id="category-filter"
            class="category-dropdown bg-neutral-800 border border-neutral-600 text-neutral-200 text-sm rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer"
          >
            <option value="all">All Categories</option>
            <option value="worldbuilding">üåç Worldbuilding</option>
            <option value="game_dev">üéÆ Game Dev</option>
            <option value="look_dev">üé® Look Dev</option>
            <option value="tech_art">‚öôÔ∏è Tech Art</option>
            <option value="vfx">üé¨ VFX</option>
          </select>
        </div>

        <!-- Controls -->
        <div id="header-controls" class="flex items-center space-x-4">
          <!-- Countdown Timer -->
          <div
            class="text-right bg-neutral-800/50 px-4 py-2 rounded-lg border border-neutral-700"
          >
            <span class="text-xs uppercase text-neutral-500 tracking-wider"
              >Time Remaining</span
            >
            <div
              id="countdown-timer"
              class="text-2xl font-bold text-neutral-100"
            >
              30:00
            </div>
          </div>

          <!-- Debug Mode Toggle Container -->
          <div
            id="debug-controls-container"
            class="flex items-center space-x-2 pl-4 border-l border-neutral-700"
          >
            <input
              type="checkbox"
              id="debug-toggle"
              class="form-checkbox h-4 w-4 text-emerald-500 bg-neutral-700 border-neutral-600 rounded focus:ring-emerald-500"
            />
            <label
              for="debug-toggle"
              class="text-sm font-medium text-neutral-300"
              >Debug Mode</label
            >
          </div>

          <!-- Debug Dropdown Menu (Visible only when Debug Mode is ON) -->
          <div
            id="debug-dropdown"
            class="absolute top-16 right-8 w-72 p-4 bg-neutral-800 rounded-lg shadow-xl border border-neutral-700 z-50 space-y-3 hidden"
          >
            <h4
              class="text-lg font-semibold text-red-400 border-b border-neutral-700 pb-2"
            >
              Admin Tools
            </h4>

            <!-- Step Navigation -->
            <div class="space-y-2">
              <p class="text-xs text-neutral-400 uppercase tracking-wide">
                Step Navigation
              </p>
              <div class="flex gap-2">
                <button
                  id="debug-prev-step"
                  class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1.5 rounded-lg text-sm"
                >
                  ‚Üê Prev
                </button>
                <button
                  id="debug-next-step"
                  class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1.5 rounded-lg text-sm"
                >
                  Next ‚Üí
                </button>
              </div>
              <button
                id="debug-skip-to-end"
                class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-1.5 rounded-lg text-sm"
              >
                Skip to Conclusion
              </button>
              <div
                class="text-xs text-neutral-400 bg-neutral-700/50 p-2 rounded"
              >
                Current:
                <span id="debug-current-step" class="text-yellow-400"
                  >None</span
                >
              </div>
            </div>

            <!-- Hard Reset -->
            <div class="pt-2 border-t border-neutral-700 space-y-2">
              <p class="text-xs text-neutral-400 uppercase tracking-wide">
                Progress Management
              </p>
              <div class="flex gap-2">
                <button
                  id="export-progress-btn"
                  class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1.5 rounded-lg text-sm"
                  onclick="exportProgress()"
                >
                  üì§ Export
                </button>
                <button
                  id="import-progress-btn"
                  class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-1.5 rounded-lg text-sm"
                  onclick="document.getElementById('import-file').click()"
                >
                  üì• Import
                </button>
                <input type="file" id="import-file" accept=".json" onchange="importProgress(event)" style="display:none;">
              </div>
              <button
                id="hard-reset-btn"
                class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-1.5 rounded-lg text-sm shadow-md transition-all duration-200"
              >
                Clear Cache & Restart
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Assessment Progress Bar -->
      <div id="assessment-progress" class="w-full max-w-7xl mb-6">
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm font-medium text-neutral-400"
            >Assessment Progress</span
          >
          <span id="progress-text" class="text-sm text-neutral-500"
            >0 of 0 modules complete</span
          >
        </div>
        <div class="progress-track">
          <div id="progress-bar" class="progress-fill" style="width: 0%"></div>
        </div>
      </div>

      <!-- Main Assessment Grid -->
      <div
        id="jira-board"
        class="w-full max-w-7xl grid grid-cols-1 md:grid-cols-3 gap-6 flex-grow min-h-[70vh]"
      >
        <!-- Column 1: Module Selection -->
        <div
          id="backlog-column"
          class="md:col-span-1 rounded-lg shadow-2xl overflow-hidden flex flex-col"
          style="
            background: var(--ue-bg-dark);
            border: 1px solid var(--ue-border-dark);
          "
        >
          <div
            class="p-4 border-b"
            style="
              background: linear-gradient(135deg, #12121a 0%, #1a1a28 100%);
              border-color: var(--ue-border-dark);
            "
          >
            <h2 class="text-lg font-bold text-neutral-100">
              Assessment Modules
            </h2>
            <p class="text-xs text-neutral-500 mt-1">
              Select a module to begin evaluation
            </p>
          </div>
          <div
            id="backlog-list"
            class="space-y-0 overflow-y-auto flex-grow"
            style="max-height: calc(100vh - 350px)"
          >
            <!-- Backlog tickets will be injected here by game.js -->
          </div>
        </div>

        <!-- Column 2: Question View -->
        <div
          id="ticket-view-column"
          class="md:col-span-2 rounded-lg shadow-2xl overflow-hidden flex flex-col"
          style="
            background: var(--ue-bg-dark);
            border: 1px solid var(--ue-border-dark);
          "
        >
          <!-- Placeholder -->
          <div
            id="ticket-placeholder"
            class="flex-grow flex flex-col items-center justify-center p-8 text-center"
          >
            <div
              class="w-20 h-20 rounded-full flex items-center justify-center mb-6"
              style="
                background: linear-gradient(135deg, #1e3a5f, #2563eb);
                border: 2px solid #3b82f6;
              "
            >
              <svg
                class="w-10 h-10 text-blue-300"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <circle cx="12" cy="12" r="10" stroke-width="2"></circle>
                <path
                  stroke-width="2"
                  d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"
                ></path>
                <line
                  x1="12"
                  y1="17"
                  x2="12.01"
                  y2="17"
                  stroke-width="2"
                ></line>
              </svg>
            </div>
            <h3 class="text-xl font-bold text-neutral-200 mb-2">
              Select a Module
            </h3>
            <p class="text-neutral-500 max-w-sm">
              Choose an assessment module from the left panel to begin your
              evaluation.
            </p>
          </div>

          <!-- Active Ticket Content (hidden by default) -->
          <div id="ticket-content" class="hidden flex-grow flex-col">
            <!-- Ticket Header -->
            <div
              id="ticket-header"
              class="p-5 bg-neutral-700/50 border-b border-neutral-600"
            >
              <h3
                id="ticket-title"
                class="text-2xl font-bold text-blue-300 mb-2"
              ></h3>
              <p id="ticket-description" class="text-sm text-neutral-400"></p>
            </div>

            <!-- Step Content Area -->
            <div class="flex-grow p-6 overflow-y-auto">
              <div id="ticket-step-content">
                <!-- Screenshot Container -->
                <div
                  id="screenshot-container"
                  class="screenshot-area mb-6 hidden"
                >
                  <!-- Image injected via JS -->
                </div>
                <!-- Step prompt, feedback, and choices will be injected here -->
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- End Jira Grid -->
    </main>

    <!-- 'Time's Up' Screen / FINAL ASSESSMENT MODAL -->
    <div
      id="times-up-screen"
      class="hidden fixed inset-0 bg-neutral-900 bg-opacity-75 p-8 flex items-center justify-center z-50"
    >
      <!-- Content will be dynamically injected here by showAssessmentModal -->
    </div>

    <!-- Load Scenario Data FIRST (using defer) -->
    <!-- <script src="questions.js" defer></script> -->
    <!-- OLD: Contains legacy scenario data -->

    <!-- Load Configuration FIRST (no defer - needed immediately) -->
    <script src="js/scorm12-helper.js"></script>
    <script src="js/xapi-helper.js"></script>
    <script src="js/LMSReporter.js"></script>
    <script src="js/config.js"></script>
    <script src="js/Validator.js" defer></script>

    <!-- Load Scenario Template Factory (provides helper functions) -->
    <script src="scenarios/00_template.js" defer></script>

    <!-- Load Scenario Manifest (initializes window.SCENARIOS) -->
    <script src="scenarios/00_manifest.js" defer></script>

    <!-- Core Engine Scripts -->
    <script src="js/core/timer.js" defer></script>
    <script src="js/core/state.js" defer></script>
    <script src="js/core/debug.js" defer></script>
    <script src="js/core/scoring.js" defer></script>
    <script src="js/core/ChoiceEnhancer.js" defer></script>
    <script src="js/core/test-utils.js" defer></script>

    <script src="js/ui/modal.js" defer></script>
    <script src="js/ui/feedback.js" defer></script>
    <script src="js/ui/backlog.js?v=3" defer></script>
    <script src="js/ui/image-modal.js" defer></script>
    <script src="js/ui/CompletionModal.js" defer></script>

    <script src="js/ActionRegistry.js" defer></script>
    <script src="js/RecipeRegistry.js" defer></script>
    <script src="js/Validator.js" defer></script>
    <script src="js/ScenarioEngine.js" defer></script>

    <!-- Load All Scenarios (29 total) -->
    <!-- game_dev (9) -->
    <script src="scenarios/game_dev/ComponentMobilityBlock.js" defer></script>
    <script
      src="scenarios/game_dev/DestroyActorStopsExecutionFlow.js"
      defer
    ></script>
    <script src="scenarios/game_dev/LockedCinematicCleanup.js" defer></script>
    <script src="scenarios/game_dev/SecurityDoorLogicGap.js" defer></script>
    <script
      src="scenarios/game_dev/SequencerLightRestoreStateIssue.js"
      defer
    ></script>
    <script src="scenarios/game_dev/VaultSequenceLockup.js" defer></script>
    <script src="scenarios/game_dev/InputActionNotResponding.js" defer></script>
    <script
      src="scenarios/game_dev/AIBehaviorTreeBlackboardIssue.js"
      defer
    ></script>
    <script
      src="scenarios/game_dev/ReplicationVariableNotSyncing.js"
      defer
    ></script>
    <!-- look_dev (9) -->
    <script
      src="scenarios/look_dev/BlackMaterialDueToEmissiveMiswiring.js"
      defer
    ></script>
    <script src="scenarios/look_dev/BlackMetallicObject.js" defer></script>
    <script
      src="scenarios/look_dev/DecalTextureAlphaMaskFailure.js"
      defer
    ></script>
    <script
      src="scenarios/look_dev/MaterialNotRenderingInPIE.js"
      defer
    ></script>
    <script
      src="scenarios/look_dev/TextureBlurryDespiteHighRes.js"
      defer
    ></script>
    <script
      src="scenarios/look_dev/LumenReflectionIncorrectColor.js"
      defer
    ></script>
    <script
      src="scenarios/look_dev/SubstrateMaterialLayerConflict.js"
      defer
    ></script>
    <script
      src="scenarios/look_dev/NaniteVSMIntegrationIssue.js"
      defer
    ></script>
    <script
      src="scenarios/look_dev/VirtualShadowMapArtifacts.js"
      defer
    ></script>
    <!-- tech_art (10) -->
    <script src="scenarios/tech_art/DanglingAssetRedirectors.js" defer></script>
    <script
      src="scenarios/tech_art/MaterialParameterAndAnimJitter.js"
      defer
    ></script>
    <script
      src="scenarios/tech_art/MismatchedSkeletonReference.js"
      defer
    ></script>
    <script
      src="scenarios/tech_art/RedirectorAndBulkLoadConflict.js"
      defer
    ></script>
    <script src="scenarios/tech_art/generator.js" defer></script>
    <script
      src="scenarios/tech_art/AnimationRetargetBoneNaming.js"
      defer
    ></script>
    <script src="scenarios/tech_art/BlendSpaceFootSliding.js" defer></script>
    <script
      src="scenarios/tech_art/ControlRigFootIKGroundPenetration.js"
      defer
    ></script>
    <script
      src="scenarios/tech_art/LiveLinkBodyTrackingJitter.js"
      defer
    ></script>
    <script
      src="scenarios/tech_art/PhysicsAssetRagdollExplosion.js"
      defer
    ></script>
    <!-- vfx (8) -->
    <script src="scenarios/vfx/nanite_wpo_failure.js" defer></script>
    <script
      src="scenarios/vfx/VolumetricShadowingPerformance.js"
      defer
    ></script>
    <script src="scenarios/vfx/NiagaraEmitterNotSpawning.js" defer></script>
    <script src="scenarios/vfx/SequencerCameraCutNotPlaying.js" defer></script>
    <script
      src="scenarios/vfx/NiagaraDataInterfaceBindingError.js"
      defer
    ></script>
    <script src="scenarios/vfx/NiagaraGPUSimulationFallback.js" defer></script>
    <script src="scenarios/vfx/NiagaraRibbonTrailGaps.js" defer></script>
    <script src="scenarios/vfx/SequencerAudioSyncDrift.js" defer></script>
    <!-- worldbuilding (9) -->
    <script
      src="scenarios/worldbuilding/ForcedDataLayerUnload.js"
      defer
    ></script>
    <script
      src="scenarios/worldbuilding/WorldPartitionDeepDive.js"
      defer
    ></script>
    <script
      src="scenarios/worldbuilding/WorldPartitionActorNotLoading.js"
      defer
    ></script>
    <script
      src="scenarios/worldbuilding/WorldPartitionCellBoundaryPopIn.js"
      defer
    ></script>
    <script src="scenarios/worldbuilding/HLODNotGenerating.js" defer></script>
    <script
      src="scenarios/worldbuilding/LandscapeStreamingHoles.js"
      defer
    ></script>
    <script
      src="scenarios/worldbuilding/LevelInstanceEditingBlocked.js"
      defer
    ></script>
    <script
      src="scenarios/worldbuilding/OneFilePerActorMergeConflict.js"
      defer
    ></script>
    <script
      src="scenarios/worldbuilding/PCGGraphNotGenerating.js"
      defer
    ></script>

    <!-- Game Logic Modules (load before game.js) -->
    <script src="js/game/GameState.js" defer></script>
    <script src="js/game/AssessmentModal.js" defer></script>
    <script src="js/game/StepRenderer.js" defer></script>
    <script src="js/game/ScenarioManager.js" defer></script>
    <script src="js/game/DebugNavigation.js" defer></script>
    <script src="js/game/ChoiceHandler.js" defer></script>

    <!-- ReviewCore SDK -->
    <script src="review-sdk/ReviewCore.js" defer></script>
    <script src="review-sdk/ReviewStorage.js" defer></script>
    <script src="review-sdk/ReviewGoogleSheets.js" defer></script>
    <script src="review-sdk/ReviewUI.js" defer></script>

    <!-- Load Game Logic LAST (using defer, ensuring it runs after all modules) -->
    <script src="game.js?v=4" defer></script>
  </body>
</html>
