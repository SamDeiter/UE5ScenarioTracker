window.SCENARIOS['dash'] = {
    meta: {
      title: "Player Dash Ability is Broken",
      description:
        "Traversal ability unresponsive. Covers input setup, cooldowns, movement, effects, and replication.",
      estimateHours: 16.0,
        difficulty: "Advanced",
        category: "Performance" // Adjusted for a more realistic, yet efficient, completion target
    },
    start: "step-1",
    steps:
      {
        // === 1. INPUT & CORE MECHANICS (Input Mapping, Movement, Cooldowns) ===
        'step-1': {skill:'input',title:'The Unresponsive Dash',prompt:"<p>You've set up an Enhanced Input Action for a player dash, but pressing the button does nothing. The <code>OnStarted</code> event never fires in your Character Blueprint.</p><strong>What is the most common reason for an Enhanced Input Action to fail?</strong>",choices:[{text:'The <code>Input Mapping Context</code> containing the dash action has not been added to the <code>Player Controller</code> at runtime.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> Enhanced Input requires you to explicitly add your mapping contexts to the player's subsystem, usually on <code>BeginPlay</code>. Without this step, the system has no registered actions to listen for.</p>",next:'step-2'},{text:'The input event is being consumed by another Blueprint.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> This is a possible issue, but the mapping context not being added is a more fundamental setup error that would prevent the input from ever being processed in the first place.</p>",next:'step-2'},{text:'The <code>Input Action</code> asset has <code>Consume Input</code> unchecked.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> This setting controls whether the input continues down the stack *after* it fires. It doesn't prevent the initial event from firing.</p>",next:'step-2'},{text:'The <code>Character Movement Component</code> is blocking the input.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> The movement component handles movement logic; it does not block raw input action events from firing.</p>",next:'step-1W'}]},
        'step-1W': {skill:'input',title:'Wrong Subsystem',prompt:"<p>You search your Character Blueprint's <code>BeginPlay</code> but can't find where to add the mapping context. You try adding it to the Game Instance instead, but it still doesn't work.</p><strong>Where is the correct place to add an Input Mapping Context?</strong>",choices:[{text:'Get the <code>Player Controller</code>, get its <code>Enhanced Input Local Player Subsystem</code>, and call <code>Add Mapping Context</code>.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> You've found the correct execution path. Input is managed by a player-specific subsystem, which is accessed through the <code>Player Controller</code>.</p>",next:'step-2'},{text:'Add it in the <code>Project Settings</code> under <code>Input</code>.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> That section is for the legacy input system. Enhanced Input is configured via its own assets and must be added at runtime.</p>",next:'step-2'},{text:'The <code>Level Blueprint</code> must add it for all players.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> While this might work for a single-player game, it's bad practice. Input is player-specific and should be handled in a player-specific class like the Player Controller or Pawn.</p>",next:'step-2'},{text:'You have to cast to the specific pawn from the <code>Player Controller</code> first.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> The subsystem exists on the Local Player, which is accessible directly from the Player Controller. You don't need a reference to the pawn for this step.</p>",next:'step-2'}]},
        
        // --- Core Movement Logic ---
        'step-2': {skill:'movement',title:'Movement Without Motion',prompt:"<p>The input now fires! Your logic calls a <code>Launch Character</code> node to propel the player forward. You use a <code>Print String</code> to confirm the node is executing, but your character doesn't move at all.</p><strong>What is the most likely reason for <code>Launch Character</code> to do nothing?</strong>",choices:[{text:'The <code>Launch Velocity</code> input is <code>(0,0,0)</code>, or the player is already moving at max speed and the current velocity is not being overridden.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> A zero-vector launch will have no effect. You must calculate a velocity based on the character's forward direction. Also, ensure the <code>XYOverride</code> and <code>ZOverride</code> booleans are checked to ignore current velocity.</p>",next:'step-3'},{text:'The <code>Character Movement Component</code> has <code>Simulate Physics</code> enabled.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> <code>Launch Character</code> is designed to work with the Character Movement Component's standard (non-physics-simulating) movement modes.</p>",next:'step-3'},{text:'The player is blocked by a small object on the floor.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> If the player were blocked, you would typically see a small nudge or collision effect. A complete lack of any motion points to a zero-velocity input.</p>",next:'step-2M'},{text:'The <code>Event Tick</code> on the character is disabled.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> <code>Launch Character</code> is an impulse and does not depend on the actor's Tick being enabled to function.</p>",next:'step-3'}]},
        
        'step-2M': {skill:'movement',title:'Adjusting Walk Speed (Dead End)',prompt:"<p>You decide the character is too heavy and try increasing the <code>Max Walk Speed</code> and <code>Braking Deceleration</code> on the <code>Character Movement Component</code>.</p><p>This is a dead end! <code>Max Walk Speed</code> and <code>Braking Deceleration</code> only affect ground movement and are irrelevant to the <code>Launch Character</code> node. The character still doesn't move.</p><strong>What must you check next?</strong>",choices:[{text:'Check the <code>Launch Velocity</code> input for a zero vector, and check the <code>XYOverride</code>/<code>ZOverride</code> booleans.',type:'correct',feedback:'<p><strong>Optimal Time Logged:</strong> Returning to the core issue. The problem is with the launch parameters, not the character's standard locomotion settings.</p>",next:'step-3'},{text:'Delete the <code>Launch Character</code> node and replace it with <code>Add Force</code>.',type:'wrong',feedback:'<p><strong>Maximum Time Logged (Ineffective Fix):</strong> <code>Add Force</code> requires simulating physics and is completely inappropriate for Character movement.</p>",next:'step-3'},{text:'Check if the character's mesh has <code>No Collision</code> set.',type:'misguided',feedback:'<p><strong>Extended Time Logged (Investigation):</strong> Collision prevents motion, but not *absence* of motion. You are wasting time on unrelated settings.</p>",next:'step-3'}]},

        // --- Cooldown and Resource Management ---
        'step-3': {skill:'systems',title:'Infinite Dashes',prompt:"<p>You fix the velocity calculation and the dash works! However, the player can spam the dash button infinitely without any limitation. The dash is supposed to have a 2-second cooldown.</p><strong>What is the standard way to implement a cooldown for an ability?</strong>",choices:[{text:'Use a boolean like <code>bIsDashOnCooldown</code>, set it to true after dashing, and use a <code>Set Timer by Event</code> node with a 2-second delay to call an event that sets it back to false.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> This is a robust and common pattern. The boolean acts as a gate for the ability, and the timer reliably re-opens the gate after the specified duration.</p>",next:'step-4'},{text:'On dash, record the <code>Get Game Time in Seconds</code> and, on the next attempt, check if the current time is greater than the recorded time plus 2.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> This works, but it's less efficient than a timer because it requires you to run this check every time the input is pressed. The boolean gate is a cleaner, more performant approach.</p>",next:'step-4'},{text:'Add a <code>Delay</code> node for 2 seconds at the end of the dash logic.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> This is a critical error. A Delay node will freeze the entire execution chain. If the player presses the button during the delay, the input will be ignored. It does not prevent the initial logic from running again.</p>",next:'step-4'},{text:'Create a <code>Timeline</code> that is 2 seconds long and only allow dashing when it is finished.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> Timelines are for updating values over time (like a fade or a pulse), not for simple cooldown timers. A Timer is the correct and more lightweight tool for this job.</p>",next:'step-4'}]},
        'step-4': {skill:'systems',title:'Free Stamina',prompt:"<p>The cooldown works. Now, the dash is supposed to cost 25 stamina, but the player's stamina bar doesn't decrease. You have a 'Stamina' float variable on your Character Blueprint.</p><strong>The dash logic includes a node that subtracts 25 from the 'Stamina' variable. Why might the value not be changing?</strong>",choices:[{text:'The logic checks if the player has <strong>enough</strong> stamina <strong>before</strong> subtracting, but the initial check is failing, preventing the subtraction from ever running.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> This is a common logic flow error. You put a guard clause (e.g., <code>Branch: Stamina >= 25</code>) at the start, but if the player's stamina is, for example, 24.9, the subtraction logic is never reached.</p>",next:'step-5'},{text:'The <code>Stamina</code> variable is not marked as <code>Instance Editable</code>.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> This setting only affects whether you can change the variable's default value from the level editor. It has no impact on changing the value at runtime via Blueprint nodes.</p>",next:'step-5'},{text:'The subtraction is happening, but another node on <code>Event Tick</code> is resetting the stamina back to full every frame.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> This is a plausible and frustrating bug, but it's a good practice to first check the logic immediately surrounding the ability call before hunting for unrelated logic on the Tick event.</p>",next:'step-5'},{text:'You are trying to subtract from a local variable that was copied from the real Stamina variable, instead of the actual class member variable.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> While this is a common error in text-based programming, in Blueprints you typically drag the variable directly from the 'My Blueprint' panel, so this is less likely.</p>",next:'step-5'},]},
        
        // === 2. VFX, SOUND, & CAMERA ISSUES (Cosmetics) ===
        'step-5': {skill:'vfx',title:'The Silent Whoosh',prompt:"<p>The stamina cost is now correctly applied. A 'whoosh' sound is supposed to play during the dash via a <code>Play Sound at Location</code> node. The node is executing, but no sound is heard.</p><strong>What is the most fundamental reason for this node to fail to produce sound?</strong>",choices:[{text:'The <code>Sound</code> input pin on the node is not assigned to a <code>Sound Wave</code> or <code>Sound Cue</code> asset.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> Just like many other nodes, if the primary asset input is <code>None</code>, the node will execute silently but do nothing. This is always the first thing to check.</p>",next:'step-6'},{text:'The <code>Location</code> input is <code>(0,0,0)</code> and the player is far away from the world origin.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> This would also result in silence, but a missing sound asset is a more common and basic setup error.</p>",next:'step-6'},{text:'The sound's <code>Attenuation</code> settings have a radius of zero.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> This is a plausible cause, but it's a data issue within the sound asset itself. You should first verify that the Blueprint node is even configured with an asset to play.</p>",next:'step-6'},{text:'You are using <code>Play Sound at Location</code> instead of <code>Play Sound 2D</code>.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> A dash sound is spatialized and should emanate from the player, so <code>Play Sound at Location</code> is the correct node to use. <code>Play Sound 2D</code> is for non-spatial UI sounds.</p>",next:'step-6'}]},
        'step-6': {skill:'vfx',title:'The Invisible Trail',prompt:"<p>The dash sound now plays correctly. A Niagara particle system is supposed to create a trail effect, but no particles appear. You've added a Niagara Component to your Character Blueprint.</p><strong>What is the most common reason for a Niagara Component to not play its effect at runtime?</strong>",choices:[{text:'The component's <code>Auto Activate</code> property is set to false, and you have not explicitly called the <code>Activate</code> node on the component in your dash logic.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> For performance, it's common practice to disable auto-activation for effects that only play on demand. You must manually trigger them with an <code>Activate</code> node when the ability is used.</p>",next:'step-7'},{text:'The Niagara System asset itself has a compile error.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> This is possible, but you should always check your Blueprint activation logic first. A missing <code>Activate</code> call is far more common than a broken asset.</p>",next:'step-7'},{text:'The material used by the particles is transparent, making them invisible.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> While a bad material could cause issues, it's highly unlikely to be completely invisible. It's more probable that the system isn't being told to run at all.</p>",next:'step-7'},{text:'The <code>Niagara Component</code> must be the root component of the <code>Blueprint</code>.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> Particle components are meant to be attached to other components (like the character's mesh) and should almost never be the root.</p>",next:'step-7'}]},
        
        // === 3. NETWORKING & REPLICATION ISSUES (Cosmetics & Authority) ===
        'step-7': {skill:'rep',title:'The Invisible Dash',prompt:"<p>The dash now works perfectly for you. In multiplayer, however, you can see your own dash effect, but you can't see other players dashing. They just teleport from point A to B.</p><strong>Why are the cosmetic parts of the dash (sound, VFX) not visible on other clients?</strong>",choices:[{text:'The events that trigger the cosmetics are only running on the server and the local client. They need to be called from a <code>Multicast</code> RPC to execute on all clients.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> The server handles the authoritative movement (the teleport), which everyone sees. But cosmetic effects must be explicitly told to play for all observers via a Multicast event.</p>",next:'step-8'},{text:'The <code>Niagara System</code> asset needs its <code>Replicates</code> flag checked.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> Assets do not have replication flags. Their *execution* must be controlled by replicated logic.</p>",next:'step-8'},{text:'The other clients are too far away to see the effect.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> This is a logic replication issue, not a distance or culling problem. The clients are not being told to play the effect at all.</p>",next:'step-8'},{text:'The logic should be in a <code>Run on Owning Client</code> RPC instead.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> This would make the effect visible to the player who is dashing (which it already is), but other players still wouldn't see it. A Multicast is needed to show it to everyone.</p>",next:'step-8'}]},
        
        // --- Movement Authority and Synchronization ---
        'step-8': {skill:'rep',title:'The Snap-Back',prompt:"<p>You've multicast the cosmetic effects. Now, clients report that when they dash, they move smoothly for a moment and then snap back to their starting position.</p><strong>What causes this classic client-server desynchronization?</strong>",choices:[{text:'The dash logic (e.g., <code>Launch Character</code>) is only being executed on the client. The server, which has authority, doesn't know the dash occurred and corrects the client's position.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> This is a fundamental networking concept. Any action that changes an actor's position must be executed on the server. The client's input should trigger a <code>Run on Server</code> RPC that contains the movement logic.</p>",next:'step-9'},{text:'The client's network connection is lagging.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> Lag will make the snap-back more noticeable, but the root cause is the logical error of not running the movement code on the server.</p>",next:'step-9'},{text:'The <code>Character Movement Component</code> has <code>Allow Client-Side Prediction</code> disabled.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> Client-side prediction is what allows clients to feel responsive. You try enabling it to fix the snap-back.</p>",next:'step-8M'},{text:'The Multicast event for the VFX is interfering with the movement.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> Cosmetic events and character movement are handled by separate systems and do not interfere with each other. This is a complete distraction.</p>",next:'step-8W'}]},
        
        // Dead-end: Client Prediction Failure
        'step-8M': {skill:'rep',title:'Client Prediction Failure (Dead End)',prompt:"<p>You enabled <code>Allow Client-Side Prediction</code>, but the character still snaps back. Client-side prediction helps smooth *movement interpolation*, but it relies on the server validating and accepting the input, which isn't happening because the dash isn't running on the server.</p><strong>What is the next logical step to ensure the dash is acknowledged by the server?</strong>",choices:[{text:'The client's input must trigger a <code>Run on Server</code> RPC that contains the movement logic.',type:'correct',feedback:'<p><strong>Optimal Time Logged:</strong> You correctly identified the need for server authority over movement, not just client-side prediction.</p>",next:'step-9'},{text:'Check the <code>Is Authority</code> node before the launch and branch the logic.',type:'partial',feedback:'<p><strong>Standard Time Logged:</strong> Checking authority is often a good practice, but it doesn't solve the core problem of getting the client input to execute the authoritative action on the server.</p>",next:'step-9'},{text:'Increase the <code>Network Update Frequency</code> on the character.',type:'misguided',feedback:'<p><strong>Extended Time Logged (Investigation):</strong> This just increases the rate of the snap-back, not preventing the server from correcting the move.</p>",next:'step-9'}]},
        
        // Dead-end: Irrelevant Authority Check
        'step-8W': {skill:'rep',title:'Irrelevant Authority Check (Dead End)',prompt:"<p>You waste time checking the relationship between the cosmetic multicast and character movement. This is a false lead; they are handled separately.</p><strong>What fundamental networking principle are you overlooking regarding player movement?</strong>",choices:[{text:'The client's input must trigger a <code>Run on Server</code> RPC that contains the movement logic.',type:'correct',feedback:'<p><strong>Optimal Time Logged:</strong> Client-driven movement must always be executed by the server to maintain network authority and synchronization.</p>",next:'step-9'},{text:'Check the <code>Is Valid</code> node before the launch and branch the logic.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> Irrelevant to network authority.</p>",next:'step-9'},{text:'Increase the size of the <code>Replicated Movement</code> property struct.',type:'wrong',feedback:'<p><strong>Maximum Time Logged (Ineffective Fix):</strong> Incorrectly looking for a setting that doesn't exist to solve a logic error.</p>",next:'step-9'}]},

        // === 4. ANIMATION & COLLISION REFINEMENT ===
        'step-9': {skill:'collision',title:'Dashing Through Walls',prompt:"<p>You've moved the dash logic to a server RPC and it replicates correctly. However, QA reports that if they dash at a thin wall, they sometimes pass right through it.</p><strong>What feature of the Character Movement Component is designed to prevent this?</strong>",choices:[{text:'Enabling <code>Sweep</code> on the movement call (e.g., <code>Set Actor Location</code>) or using a movement component function that sweeps automatically, like <code>Add Movement Input</code>.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> A 'teleport' without a sweep will not check for collisions between the start and end points. Enabling sweeping treats the movement as a continuous motion and respects collision, preventing tunneling.</p>",next:'step-10'},{text:'Increasing the character's capsule radius.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> While a larger capsule makes collision more likely, it doesn't solve the underlying issue of teleporting through objects without checking the path taken.</p>",next:'step-10'},{text:'Enabling <code>Continuous Collision Detection</code> (CCD) on the capsule component.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> CCD is for physics-simulating objects to prevent tunneling at high speeds. For Character Movement, which is not a true physics simulation, sweeping is the correct and more performant solution.</p>",next:'step-10'},{text:'Increasing the mass of the character.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> Mass has no effect on the kinematic movement of the Character Movement Component.</p>",next:'step-10'}]},
        'step-10': {skill:'animation',title:'The Static Dash',prompt:"<p>The dash is mechanically sound. Now for the animation. You have a dash animation montage, but when you call <code>Play Anim Montage</code>, the character remains in their idle/run pose.</p><strong>What is a common setup error that prevents an Anim Montage from playing?</strong>",choices:[{text:'The <code>Anim BP's AnimGraph</code> is missing a <code>Slot</code> node. Montages need a named slot to play into, which overrides the base animation from the state machine.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> The <code>AnimGraph</code> is a flow of poses. A <code>Slot</code> node acts as an injection point where a montage can temporarily take over the final animation pose.</p>",next:'step-11'},{text:'The montage asset has not been saved.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> An unsaved asset would likely result in a <code>None</code> reference and a warning in the output log. If the node is executing without warnings, the problem is likely in the Anim BP setup.</p>",next:'step-11'},{text:'The character is not in the correct <code>Movement Mode</code> (e.g., <code>Falling</code>).',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> Montages can be played regardless of the character's movement mode.</p>",next:'step-11'},{text:'You must use <code>Play Animation</code> instead of <code>Play Anim Montage</code>.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> <code>Play Animation</code> is for simple, single-asset playback. Montages are specifically designed for layered, temporary animations like attacks or abilities, and <code>Play Anim Montage</code> is the correct node.</p>",next:'step-11'}]},
        'step-11': {skill:'animation',title:'The Blending Snap',prompt:"<p>You add a Slot node and the dash montage now plays. However, it snaps into the animation and snaps back out instantly, which looks very jarring.</p><strong>What controls the smooth transition into and out of a montage?</strong>",choices:[{text:'The <code>Blend In</code> and <code>Blend Out</code> time settings within the <code>Anim Montage</code> asset itself.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> These properties, found in the montage's details panel, control the duration over which the engine will interpolate from the base animation pose to the montage pose, and vice-versa.</p>",next:'step-12'},{text:'The <code>Interpolation</code> settings on the <code>Blendspace</code> used in the <code>State Machine</code>.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> Blendspace interpolation affects transitions *within* the state machine (e.g., from idle to run), not how a montage blends on top of it.</p>",next:'step-12'},{text:'A 'Montage Blend' node in the Anim BP event graph.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> No such node exists. Blending is controlled by the montage asset's data.</p>",next:'step-12'},{text:'The <code>Play Rate</code> input on the <code>Play Anim Montage</code> node.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> Play Rate controls the speed of the animation's playback, not the smoothness of the transition into it.</p>",next:'step-12'}]},
        'step-12': {skill:'animation',title:'The Root Motion Problem',prompt:"<p>The dash is now moving the player almost twice as far as intended. It seems like two systems are applying motion.</p><strong>What is the cause of this 'double movement'?</strong>",choices:[{text:'The animation has <code>Root Motion</code>, and you are also applying movement with a <code>Launch Character</code> node. You should do one or the other, not both.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> <code>Root Motion</code> extracts movement from the animation itself and applies it to the character. If you're also applying a manual launch, you're applying two sources of velocity. You should either disable <code>Root Motion</code> or remove the <code>Launch Character</code> call.</p>",next:'step-13'},{text:'The animation's <code>Play Rate</code> is set to 2.0.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> A faster play rate would make the animation finish faster, but it wouldn't double the distance of a separate <code>Launch Character</code> call.</p>",next:'step-13'},{text:'The server is correcting the client's position, causing an overshoot.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> A server correction would typically cause a snap-back, not a consistent doubling of movement distance.</p>",next:'step-13'},{text:'The character's <code>Max Walk Speed</code> is too high.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> Max Walk Speed applies to standard ground movement and does not affect the velocity applied by a launch or root motion.</p>",next:'step-13'}]},
        
        // --- UI & Rendering Polish ---
        'step-13': {skill:'ui',title:'Stale Stamina Bar',prompt:"<p>You decide to use <code>Launch Character</code> and disable <code>Root Motion</code>. The movement is now correct. However, the UI's stamina bar does not update immediately after a dash. It only updates after the next time the player jumps or sprints.</p><strong>What causes this kind of delayed UI update?</strong>",choices:[{text:'The UI is not being notified of the change. The stamina bar's value is probably only being updated by other events (like jumping) and not by the dash event.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> This indicates that your UI update logic is not centralized. A robust solution is to use an <code>Event Dispatcher</code> or an <code>interface call</code> whenever stamina changes, which the UI can bind to and update itself accordingly.</p>",next:'step-14'},{text:'The stamina bar widget has <code>Is Volatile</code> set to false.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> <code>Is Volatile</code> forces the widget to be redrawn every frame, which is bad for performance and doesn't solve the underlying problem that the data it's trying to draw is stale.</p>",next:'step-14'},{text:'The widget has its <code>Tick</code> disabled.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> While you could update the UI on Tick, this is inefficient ('polling'). An event-driven approach where the UI is told when to update is far better.</p>",next:'step-14'},{text:'The player's stamina variable is not replicated.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> If the variable isn't replicated, clients' UI would be out of sync with the server. However, the problem describes a delayed update even for the local player, which points to a logic flow issue, not a replication one.</p>",next:'step-14'}]},
        'step-14': {skill:'render',title:'The Missing Blur',prompt:"<p>The dash is supposed to trigger a radial blur Post Process effect. You have a Post Process Component on your character, and your logic is setting its parameters, but nothing happens to the screen.</p><strong>Why would setting parameters on a Post Process Component have no visible effect?</strong>",choices:[{text:'The component is not enabled. You need to set its <code>Enabled</code> property to true at the start of the dash and false at the end.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> Just like particle systems, Post Process Components can be enabled and disabled for performance. Simply changing their parameters won't do anything if the component itself is not active.</p>",next:'step-15'},{text:'The <code>Blend Weight</code> of the component is set to 0.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> A blend weight of 0 would also make the effect invisible. However, the enabled/disabled state is a more common and fundamental gate for the entire component's influence.</p>",next:'step-15'},{text:'The level already has an Unbound <code>Post Process Volume</code> with a higher priority.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> While priority matters for blending, even a low-priority component would have *some* visible effect unless its blend weight was zero or it was disabled.</p>",next:'step-15'},{text:'The material used for the effect has a compile error.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> A material error would likely show up as the default grid material on screen, not a complete lack of any effect.</p>",next:'step-15'}]},
        'step-15': {skill:'camera',title:'The Static Camera',prompt:"<p>The dash is supposed to briefly increase the camera's Field of View (FOV) for a sense of speed. Your logic calls <code>Set Field of View</code> on the player's camera, but the FOV remains unchanged.</p><strong>What is the most likely reason the camera's properties are not being updated?</strong>",choices:[{text:'You are getting a reference to the wrong camera. You might be modifying the default Camera Component instead of the active one, especially if you are using a system like a spring arm.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> A common error is to have multiple camera components (e.g., one for first-person, one for third-person) and get a reference to the inactive one. You must ensure you are targeting the currently active player camera.</p>",next:'step-16'},{text:'The <code>Camera Manager</code> is overriding your settings.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> The Player Camera Manager is the final authority on camera settings. If it's running a camera shake or another effect, it could be overwriting your FOV change. However, getting a bad reference to the camera itself is a more basic error.</p>",next:'step-16'},{text:'The 'Lock Camera' setting is enabled on the character.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> No such setting exists. Camera control is managed through the Player Controller and Camera Manager.</p>",next:'step-16'},{text:'You cannot change the <code>FOV</code> at runtime; it must be set in the <code>Blueprint</code> defaults.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> The FOV is designed to be changed dynamically at runtime for effects like sprinting, aiming, and dashing.</p>",next:'step-16'}]},
        
        // === 5. COLLISION, PHYSICS & MOVEMENT REFINEMENT ===
        'step-16': {skill:'physics',title:'The Immovable Crate',prompt:"<p>Dashing into a physics-simulating crate is supposed to send it flying. Instead, it just stops your dash. Your overlap logic calls an <code>Add Impulse</code> node on the crate.</p><strong>Why would <code>Add Impulse</code> fail to move an object that is simulating physics?</strong>",choices:[{text:'The impulse strength is too low compared to the mass of the object, or the crate has its <code>Lock Position</code> constraint enabled in its physics settings.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> Physics calculations are a balance of forces. If the impulse is too weak or the object's mass is astronomical, there will be no visible movement. Locked constraints would also prevent any movement.</p>",next:'step-17'},{text:'The <code>Velocity Change</code> boolean on the <code>Add Impulse</code> node is unchecked.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> Checking this box makes the impulse ignore the object's mass, which can be a good way to guarantee movement. However, the root cause is still likely an imbalance of mass and force.</p>",next:'step-17'},{text:'The crate is not a child of a Voxel Physics object.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> This is not a concept in standard Unreal Engine physics. Any component with <code>Simulate Physics</code> enabled can receive an impulse.</p>",next:'step-17'},{text:'The server is rejecting the physics interaction.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> While physics replication can be complex, a basic impulse call that fails to move an object locally points to a physics properties issue, not a networking one.</p>",next:'step-17'}]},
        'step-17': {skill:'collision',title:'Dashing Off Ledges',prompt:"<p>A new design requires an aerial dash. If the player dashes while in the air, they should move forward, not fall. Currently, they dash forward but still fall due to gravity.</p><strong>What setting in the <code>Launch Character</code> node can be used to achieve this?</strong>",choices:[{text:'Check the <code>Z Override</code> boolean. This will make the Z component of your launch velocity replace the character's current vertical velocity (i.e., gravity).',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> This is precisely what Z Override is for. By providing a Z velocity of 0 and overriding, you are effectively canceling out gravity for the duration of the launch, resulting in a horizontal air dash.</p>",next:'step-18'},{text:'Set the <code>Character Movement Component's Gravity Scale</code> to 0 before the dash.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> This would work, but it's a 'leaky' abstraction. You would need to remember to set it back to 1.0 after the dash. The <code>Launch Character</code> node's built-in override is a cleaner, more self-contained solution.</p>",next:'step-18'},{text:'Set the <code>Movement Mode</code> to <code>Flying</code> before the dash.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> While this would negate gravity, it's a heavy-handed state change that has many other side effects. It's not the intended way to implement an air dash.</p>",next:'step-18'},{text:'The Z value of the <code>Launch Velocity</code> needs to be a large positive number.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> This would launch the character upwards, not create a level horizontal dash. To cancel falling, you need to override the existing downward velocity.</p>",next:'step-18'}]},
        'step-18': {skill:'systems',title:'Dashing While Stunned',prompt:"<p>The player can still dash even when a 'stunned' gameplay effect is active. The stun effect is supposed to block all abilities.</p><strong>What is the best-practice way to have systems like stuns block abilities like the dash?</strong>",choices:[{text:'Use <code>Gameplay Tags</code>. The stun effect should grant the player a <code>State.Stunned</code> tag, and the dash ability logic should have a check for <code>Has Tag: State.Stunned</code> at the very beginning.',type:'correct',feedback:'<p><strong>Optimal Time Logged:</strong> <code>Gameplay Tags</code> are the ideal, data-driven way to manage states and abilities. It's scalable, decoupled, and makes it easy to see what states an actor is in and what abilities are blocked by those states.</p>",next:'step-19'},{text:'Create a <code>bIsStunned</code> boolean on the Player Character and check it before dashing.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> This works for one or two states, but it's not scalable. What if you add a 'rooted' state, a 'silenced' state, etc.? You'll end up with a messy pile of booleans. Tags are designed to solve this problem cleanly.</p>",next:'step-19'},{text:'From the stun logic, call <code>Disable Input</code> on the <code>Player Controller</code>.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> This is a sledgehammer approach. It would block *all* input, including looking around or opening the menu. A proper stun should only block specific actions, which tags allow you to do.</p>",next:'step-19'},{text:'The dash logic should get all actors with a 'stun' component and check if the player is one of them.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> This inverts the dependency and is very inefficient. The player should know their own state; they shouldn't have to search the entire world to find out if they are stunned.</p>",next:'step-19'}]},
        'step-19': {skill:'collision',title:'The Trace Check',prompt:"<p>To prevent dashing into walls, you add a capsule trace before the launch to see if the path is clear. However, the trace immediately hits your own character, and the dash always fails.</p><strong>How do you prevent a trace from hitting the actor that initiated it?</strong>",choices:[{text:'Add your character to the <code>Actors to Ignore</code> array pin on the trace node.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> This is the most direct and explicit way to solve the problem. The trace will then ignore the specified actor and correctly check the environment beyond it.</p>",next:'step-20'},{text:'In your character's collision settings, set the <code>Trace Response</code> channel to <code>Ignore</code>.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> This would make your character ignore *all* traces of that type, which could have unintended side effects for other systems (like AI visibility checks or weapon targeting).</p>",next:'step-20'},{text:'Set the <code>Trace Complexity</code> to <code>Simple Collision</code>.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> This determines whether the trace uses the simple physics body or the complex per-poly mesh. It doesn't affect which actors are hit.</p>",next:'step-20'},{text:'Start the trace from a location far in front of the character.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> This is a common but flawed workaround. It creates a 'dead zone' right in front of the player where obstacles won't be detected. Using 'Actors to Ignore' is the correct solution.</p>",next:'step-20'}]},
        
        // === 6. PERFORMANCE & FINAL GAS REFACTOR ===
        'step-20': {skill:'perf',title:'The Cost of Dashing',prompt:"<p>The game runs smoothly, but a profiler reveals that every time a dash occurs, there is a small but noticeable garbage collection (GC) hitch. The dash logic itself doesn't seem to be creating actors.</p><strong>What non-obvious part of Blueprint can create objects and trigger GC?</strong>",choices:[{text:'Using <code>Format Text</code> nodes or string <code>Append</code> nodes. These create new <code>FString</code> objects in memory that the garbage collector eventually needs to clean up.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> This is a common hidden performance cost. For frequently updated debug text or UI, these nodes can generate a lot of temporary string objects. In performance-critical code, it's better to avoid them.</p>",next:'step-21'},{text:'Calling a pure function.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> Pure functions are just functions that don't modify state; they do not inherently create objects or cause GC hitches.</p>",next:'step-21'},{text:'Using a <code>For Each Loop</code> node.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> Loops iterate over existing memory; they do not allocate new objects for each iteration.</p>",next:'step-21'},{text:'Creating a local variable inside a function.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> Local variables are allocated on the stack and are cleaned up when the function returns. They are not managed by the garbage collector and do not cause GC hitches.</p>",next:'step-21'}]},
        'step-21': {skill:'audio',title:'The Abrupt Sound Cutoff',prompt:"<p>The dash sound effect has a nice, fading tail. However, if the player dashes again quickly, the tail of the previous sound cuts off instantly to play the new one.</p><strong>How do you allow multiple instances of a sound to overlap and play out fully?</strong>",choices:[{text:'In the <code>Sound Cue</code> or <code>Sound Wave</code> asset, adjust the <code>Concurrency</code> settings to allow more than one instance of the sound to play at once.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> Concurrency settings manage how many instances of a sound can be active. By increasing the 'Max Count', you allow new sounds to play without stopping the old ones.</p>",next:'step-22'},{text:'Use 'Spawn Sound Attached' instead of 'Play Sound at Location'.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> Both nodes are affected by the asset's concurrency settings. Changing the node won't solve the underlying data limitation.</p>",next:'step-22'},{text:'Add a <code>Fade Out</code> node before playing the new sound.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> This would make the problem sound smoother, but it wouldn't solve the core issue of allowing the sounds to overlap naturally.</p>",next:'step-22'},{text:'In the <code>Project Settings</code>, increase the <code>Max Audio Channels</code>.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> While a very low number of max channels could cause sounds to be culled, the Concurrency setting on the asset itself is the direct and intended control for this specific behavior.</p>",next:'step-22'}]},
        
        // --- Gameplay Ability System (GAS) Conversion ---
        'step-22': {skill:'systems',title:'The State Machine Conflict (GAS)',prompt:"<p>You refactor your dash logic to use a Gameplay Ability from the Gameplay Ability System (GAS). When you try to activate the ability, it fails silently.</p><strong>What is a common reason for a Gameplay Ability to fail to activate?</strong>",choices:[{text:'The ability is being blocked by another tag. The <code>Blocked by Tags</code> property on the ability is preventing it from running while the character has a tag like <code>State.Sprinting</code>.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> <code>GAS</code> uses <code>Gameplay Tags</code> extensively for control flow. An ability can have tags that block it, and it can be blocked by tags that the character currently possesses. This is the first place to check for an activation failure.</p>",next:'step-23'},{text:'The <code>Ability System Component</code> is not on the <code>Player State</code>.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> While the ASC is often on the Player State, it can also be on the Character. The location of the component is less likely to be the issue than a tag conflict.</p>",next:'step-23'},{text:'The ability has no 'Cost' Gameplay Effect.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> An ability does not need to have a cost to be activated.</p>",next:'step-23'},{text:'The <code>Try Activate Ability by Class</code> node is bugged.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> This node is the standard way to activate abilities and is very reliable. The failure is almost certainly in your data setup (tags, costs, cooldowns), not the node itself.</p>",next:'step-23'}]},
        'step-23': {skill:'systems',title:'The Unapplied Cooldown (GAS)',prompt:"<p>Your dash ability now activates through GAS. However, the cooldown isn't working. The ability can be spammed. You have a 'Cooldown' Gameplay Effect specified in the ability's details.</p><strong>Why would a Cooldown Gameplay Effect fail to apply?</strong>",choices:[{text:'The <code>Gameplay Effect's</code> duration is set to <code>Instant</code> instead of <code>Has Duration</code>. A cooldown must have a duration to be effective.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> An instant Gameplay Effect applies and is immediately removed. For a cooldown, the effect must be applied to the character for a set duration, during which it grants a tag that blocks the ability.</p>",next:'step-24'},{text:'The <code>Gameplay Effect</code> is missing a <code>Magnitude</code> modifier.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> Magnitude is for how much an attribute is changed (e.g., damage amount). It is irrelevant for a simple cooldown tag.</p>",next:'step-24'},{text:'The <code>Cooldown Tags</code> in the ability are not set correctly.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> The ability needs to check for the cooldown tag granted by the effect. However, if the effect itself isn't applying correctly (due to being Instant), this check doesn't matter.</p>",next:'step-24'},{text:'The server is not authoritative over the Gameplay Effect.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> By default, Gameplay Effects are handled authoritatively by the server. This is not something you would typically configure incorrectly.</p>",next:'step-24'}]},
        
        // --- Final Build and Polish ---
        'step-24': {skill:'build',title:'The Cooker Warning',prompt:"<p>You are packaging a build and see a warning in the log: <code>LogCook: Warning: /Game/Characters/BP_PlayerCharacter references /Game/UI/WBP_DebugHUD. WBP_DebugHUD is an editor-only asset and will not be cooked.</code> The build succeeds, but you're concerned.</p><strong>What is the best way to fix this?</strong>",choices:[{text:'Wrap the logic that creates the debug widget in a <code>Is Standalone Screen</code> or <code>Is With Editor</code> macro node to ensure it only runs in editor builds.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> These macro nodes are specifically designed to strip out editor-only logic from packaged builds, which resolves the warning and prevents potential errors in the shipped game.</p>",next:'step-25'},{text:'Delete the debug widget logic entirely.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> The debug widget is likely useful for development. Removing it completely is a short-sighted fix. The goal is to keep it for developers but exclude it for players.</p>",next:'step-25'},{text:'Move the debug widget to the 'Developer' content folder.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> This can help organize assets, and some cooker settings can be configured to exclude developer folders. However, using the editor-only macros is a more explicit and reliable way to control the logic flow.</p>",next:'step-25'},{text:'Ignore the warning, since the build succeeded.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> A successful build with cooking warnings is not a clean build. This warning indicates that a reference will be <code>None</code> in the packaged game, which could lead to a crash if not handled properly.</p>",next:'step-25'}]},
        'step-25': {skill:'perf',title:'The Final Polish',prompt:"<p>The dash is feature-complete. The last piece of feedback is that the stop feels 'floaty'. The player continues to slide for a moment after the dash velocity is applied.</p><strong>What property in the Character Movement Component controls how quickly a character comes to a stop?</strong>",choices:[{text:'<code>Braking Deceleration Walking</code>. Increasing this value will make the character decelerate faster, resulting in a tighter, more responsive stop.',type:'correct',feedback:'<p><strong>Correct (+5 points):</strong> This is the direct physics-based property that controls friction and braking force on the ground. Tuning this value is key to achieving the desired game feel for movement.</p>",next:'conclusion'},{text:'<code>Max Acceleration</code>.',type:'misguided',feedback:'<p><strong>Misguided (+0 points):</strong> This controls how quickly the character gets *up to* max speed, not how quickly they stop.</p>",next:'conclusion'},{text:''Mass'.',type:'wrong',feedback:'<p><strong>Wrong (+0 points):</strong> Mass is not used for the standard kinematic movement calculations in the Character Movement Component. It only comes into play when being pushed by external physical forces.</p>",next:'conclusion'},{text:'<code>Use Separate Braking Friction</code>.',type:'partial',feedback:'<p><strong>Partially Correct (+2 points):</strong> This boolean enables a separate friction value for braking, but the <code>Braking Deceleration</code> is the actual value that needs to be tuned.</p>",next:'conclusion'}]}
      }
  };